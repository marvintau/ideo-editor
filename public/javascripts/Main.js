!function(t){var e={};function s(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(r,i,function(e){return t[e]}.bind(null,i));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=7)}([function(t,e,s){"use strict";s.d(e,"a",function(){return r});class r{constructor(t,e){void 0===e?void 0===t?(this.x=0,this.y=0):void 0!==t.x&&void 0!==t.y?(this.x=t.x,this.y=t.y):"number"==typeof t&&(this.x=Math.cos(t*Math.PI/180),this.y=Math.sin(t*Math.PI/180)):(this.x=t,this.y=e)}add(t){return new r(this.x+t.x,this.y+t.y)}sub(t){return new r(this.x-t.x,this.y-t.y)}mult(t){return void 0===t.x?new r(this.x*t,this.y*t):new r(this.x*t.x,this.y*t.y)}cross(t){return this.x*t.y-t.x*this.y}head(t){return new r(Math.min(this.x,t.x),Math.min(this.y,t.y))}isHeaderTo(t){return this.x<t.x&&this.y<t.y}tail(t){return new r(Math.max(this.x,t.x),Math.max(this.y,t.y))}isTailerTo(t){return this.x>t.x&&this.y>t.y}copy(){return new r(this.x,this.y)}mag(){return Math.hypot(this.x,this.y)}draw(t,e,s){void 0===s&&(s="rgb(0, 0, 0, 0.5)"),void 0===e&&(e=10),t.fillStyle=s,t.beginPath(),t.arc(this.x,this.y,e,0,2*Math.PI),t.fill()}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return CurveStructureBase});var _Vec_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_Box_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_Raster_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3);class CurveStructureBase{constructor(t,e){this.body=void 0===e||void 0===e.body?[]:e.body.map(e=>new t(e)),this.head=void 0===e||void 0===e.head?new _Vec_js__WEBPACK_IMPORTED_MODULE_0__.a:e.head,this.prog=void 0===e||void 0===e.prog?[]:e.prog,this.vars=void 0===e||void 0===e.vars?{}:e.vars,this.box=new _Box_js__WEBPACK_IMPORTED_MODULE_1__.a}rotate(t){this.body.forEach(e=>e.rotate(t)),this.update()}scale(t){this.body.forEach(e=>e.scale(t)),this.update()}trans(t){this.head=this.head.add(t),this.update()}len(){return this.body.reduce((t,e)=>t+e.len(),0)}getVariable(item){switch(typeof item){case"number":return item;case"string":switch(typeof this.vars[item].val){case"number":return this.vars[item].val;case"string":return eval(this.vars[item].val.replace(/@'(.*)'/,"this.getVariable('$1')"))}case"object":for(let t in item)item[t]=this.getVariable(item[t]);return item;default:console.error("Key not found",item,typeof item)}}getConstraint(){}modify(t,e){void 0===e&&(e=this.vars),void 0===t&&(t=this.prog);for(let t of this.body)t.modify();for(let e of t)for(let t in e){var s=void 0===e.ith?this:this.body[e.ith];"prog"!=t?s[t](this.getVariable(e[t])):s.modify(e[t])}this.update()}ith(){}update(){if(this.body.length>0&&(this.body[0].head=this.head.copy(),this.body[0].update(),this.box=this.body[0].box,this.tail=this.body[0].tail),this.body.length>1)for(let t=1;t<this.body.length;t++)try{this.body[t].head=this.body[t-1].tail.copy(),this.body[t].update(),this.tail=this.body[t].tail,this.box=this.box.union(this.body[t].box)}catch(t){}}copy(){var t=new this.constructor;return t.body=this.body.map(t=>t.copy()),t.head=this.head.copy(),t}draw(t){for(let e of this.body)e.draw(t)}sample(t){return this.body.reduce(function(e,s){return e.concat(s.sample(t))},[])}rasterize(t){if(void 0===t){var e=document.getElementById("canvas").getContext("2d"),s=e.height,r=e.width;t=new _Raster_js__WEBPACK_IMPORTED_MODULE_2__.a(r,s)}for(let e of this.body)t=e.rasterize(t);return t}}},function(t,e,s){"use strict";s.d(e,"a",function(){return i});var r=s(0);class i{constructor(t,e){void 0===e&&(e=new r.a),void 0===t&&(t=new r.a),this.head=t.copy(),this.tail=e.copy()}union(t){var e=this.head.head(t.head),s=this.tail.tail(t.tail);return new i(e,s)}copy(){return new i(this.head.copy(),this.tail.copy())}center(){return this.head.add(this.tail).mult(new r.a(.5,.5))}size(){return this.tail.sub(this.head)}include(t){return t.isTailerTo(this.head)&&t.isHeaderTo(this.tail)}moveWithHead(t){var e=this.size();return new i(t,t.add(e))}set(t,e,s,r){this.head.x=t,this.head.y=e,this.tail.x=t+s,this.tail.y=e+r}draw(t){var e=this.size();t.lineWidth=1,t.beginPath(),t.rect(this.head.x,this.head.y,e.x,e.y),t.stroke()}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});class r{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(t*e)}setPixel(t,e){this.data[this.width*(e-1)+t]=1}countSlice(t,e,s,r){var i=0;for(let o=t;o<s;o++)for(let s=e;s<r;s++)i+=this.data[e*width+t];return i}}},function(t,e,s){"use strict";function r(t,e){return[...Array(t).keys()].map(t=>e(t))}function i(t){return t.reduce((t,e)=>t.concat(Array.isArray(e)?i(e):e),[])}s.d(e,"b",function(){return r}),s.d(e,"a",function(){return i})},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return StrokeSet});var _Vec_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_CurveStructureBase_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),_CompoundCurve_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6),_Util_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4),_Box_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2);function forAllKernelSize(t,e,s,r){for(let t=s;t<=e;t+=s)for(let e=.5*t;e<=t;e+=s)r(e,t)}function findMinMax(t,e){var s=1e4,r=-1e4,i=0,o=0,n=void 0===e?t:t.map(e);for(let t in n)n[t]>r?(r=n[t],o=t):n[t]<s&&(s=n[t],i=t);return{max:parseInt(o),min:parseInt(i)}}class StrokeSet extends _CurveStructureBase_js__WEBPACK_IMPORTED_MODULE_1__.a{constructor(t){super(_CompoundCurve_js__WEBPACK_IMPORTED_MODULE_2__.a,t),this.modify(),this.cons(t)}cross(t){var e=this.body[t.dest.ith].at(t.dest),s=this.body[t.self.ith].at(t.self);this.body[t.self.ith].trans(e.sub(s))}cons(t){var e=void 0===t.cons?[]:t.cons,s={},r=!0;for(let t of e)for(let e in t)console.log(e),r&=this["cons_"+e](t[e],s);return console.log("consVars",s),r}cons_len(t,e){if(void 0===t.ith)throw{type:"TypeError",message:"ConsComp: You must specify which stroke."};if(void 0===t.to)throw{type:"TypeError",message:"ConsComp: You must specify the variable to store."};return e[t.to]=void 0===t.curve?this.body[t.ith].len():this.body[t.ith].body[t.curve].len(),!0}cons_comp(consCompSpec,consVars){if(void 0===consCompSpec.self||void 0===consCompSpec.is||void 0===consCompSpec.to)throw{type:"TypeError",message:"ConsComp: invalid Object format of consComp."};if(void 0===consVars[consCompSpec.self])throw{type:"ValueError",message:"ConsComp: given variable name not found in variable list"};if("number"!=typeof consVars[consCompSpec.self]||"number"!=typeof consCompSpec.to)throw{type:"ValueError",message:"ConsComp: the type of operand must be number"};var operators={">":0,">=":0,"<":0,"<=":0,"==":0,"!=":0};if(!(consCompSpec.is in operators))throw{type:"ValueError",message:"ConsComp: unsupported operator"};return eval(" "+consVars[consCompSpec.self]+" "+consCompSpec.is+" "+consCompSpec.to)}cons_cross(t,e){if(void 0===t||void 0===t.self||void 0===t.dest||void 0===t.self.ith||void 0===t.dest.ith)throw{type:"TypeError",message:"invalid object format of consCross."};var s=t.self,r=this.body[s.ith].body[s.curve],i=t.dest,o=this.body[i.ith].body[i.curve],n=r.cross(o);return e[s.to]=n.s,e[i.to]=n.t,!0}update(){if(this.body.length>0&&(this.body[0].update(),this.box=this.body[0].box),this.body.length>1)for(let t=1;t<this.body.length;t++)try{this.body[t].update(),this.box=this.box.union(this.body[t].box)}catch(t){console.error("StrokeSet update",this.box)}}stretchFull(t){var e,s=this.box.size(),r=t.canvas.width,i=t.canvas.height;e=Math.min(s.x,s.y)>Math.max(r,i)?Math.max(r/s.x,i/s.y):Math.min(r/s.x,i/s.y);for(let t of this.body)t.head=t.head.mult(e);this.scale(e),this.update()}transCenter(t){var e=t.canvas.width/2,s=t.canvas.height/2;for(let t of this.body)t.head=t.head.add(new _Vec_js__WEBPACK_IMPORTED_MODULE_0__.a(e,s).sub(this.box.center()));this.update()}draw(t){this.stretchFull(t),this.transCenter(t),t.clearRect(-100,-100,t.canvas.width+200,t.canvas.height+200),t.setTransform(1,0,0,1,0,0),t.translate(.05*t.canvas.width,.05*t.canvas.height),t.scale(.9,.9),t.lineWidth=25,t.lineJoin="round",t.strokeStyle="rgb(0, 0, 0, 0.5)";for(let e of this.body)e.head.draw(t),t.beginPath(),t.moveTo(e.head.x,e.head.y),e.draw(t),t.stroke()}sample(t){return this.body.reduce(function(e,s){return e.concat(s.sample(t))},[])}findCentroid(t){var e=this.sample(25),s=Object(_Util_js__WEBPACK_IMPORTED_MODULE_3__.a)(e),r=new _Vec_js__WEBPACK_IMPORTED_MODULE_0__.a;for(let t of s)r=r.add(t);r=r.mult(1/s.length),console.log("centroid: ",r),r.draw(t,10,"red")}findCenterRect(t,e){var s=Object(_Util_js__WEBPACK_IMPORTED_MODULE_3__.a)(this.sample(25)),r=t.canvas.width,i=t.canvas.height,o=0,n=new _Box_js__WEBPACK_IMPORTED_MODULE_4__.a,a=new _Box_js__WEBPACK_IMPORTED_MODULE_4__.a,h=performance.now();return forAllKernelSize(r,i,e,function(t,h){var c=[];for(let o=0;o+t<=r;o+=e)for(let r=0;r+h<=i;r+=e)n.set(o,r,t,h),c.push(s.filter(t=>n.include(t)).length);var d=findMinMax(c),u=0!=c.length?c[d.max]-c[d.min]:0;if(u>=o){o=u;var l=(i-h)/e,p=Math.ceil(d.max/l),_=p*l-d.max;a.set((p-2)*e,_*e,t,h)}}),a.draw(t),console.log("finding rect takes: ",.001*(performance.now()-h),"secs"),console.log("rect ",a),a}}function testStrokeSet(t,e){var s=new StrokeSet(e);console.log(s),t.lineWidth=1,s.draw(t),s.sample(15);for(let e of s.samples)for(let s of e)s.draw(t,5);var r=performance.now();findCenterRect(t,s.samples,20),console.log("centerrect found in:",.001*(performance.now()-r),"secs"),findCentroid(t,s.samples,150)}},function(t,e,s){"use strict";var r=s(1),i=(s(4),s(0)),o=s(2);s(3);class n extends r.a{constructor(t){super(),this.len=t.len,this.ang=t.ang,this.head=new i.a,this.tail=new i.a,this.box=new o.a,this.update()}copy(){return new n({len:this.len,ang:this.ang,head:this.head})}draw(t){t.lineTo(this.tail.x,this.tail.y)}rotate(t){this.ang+=t,this.update()}trans(t){this.head=this.head.add(new i.a(t)),this.update()}scale(t){this.len*=t,this.update()}modify(t){void 0===t&&(t=this.prog);for(let e of t)switch(Object.keys(e)[0]){case"trans":this.trans(e.trans);break;case"rotate":this.rotate(e.rotate);break;case"stretch":this.stretch(e.scale)}this.update()}update(){var t=new i.a(this.ang);this.tail=this.head.add(t.mult(this.len));var e=this.head.head(this.tail),s=this.tail.tail(this.head);this.box=new o.a(e,s)}sample(t){for(var e=[],s=new i.a(this.ang),r=t;r<this.len;r+=t)e.push(s.mult(r).add(this.head));return e}cross(t){var e=t.head.sub(t.tail).cross(t.head.sub(this.head)),s=this.head.sub(this.tail).cross(t.head.sub(this.head)),r=t.head.sub(t.tail).cross(this.tail.sub(this.head));return{s:e/r,t:s/r}}}class a extends r.a{constructor(t){super(n,t),this.update()}at(t){for(var e=t*this.body.reduce((t,e)=>t+e.len,0),s=0,r=null,i=0;i<this.body.length&&!(s+(r=this.body[i]).len>=e);i++)s+=this.body[i].len;var o=(e-s)/r.len,n=r.tail.sub(r.head).mult(o);return console.log(o),r.head.add(n)}cross(t){var e,s,r,i,o=0,n=0;for(let o=0;o<this.body.length;o++)for(let n=0;n<t.body.length;n++){var a=this.body[o].cross(t.body[n]);void 0===e?e=a.s:e<0&&a.s<0?(e=Math.max(e,a.s),r=o):e>1&&a.s>1?(e=Math.min(e,a.s),r=o):a.s>0&&a.s<1&&(e=a.s,r=o),void 0===i?i=a.t:s<0&&a.t<0?(s=Math.max(s,a.t),i=n):s>1&&a.t>1?(s=Math.min(s,a.t),i=n):a.t>0&&a.t<1&&(s=a.t,i=n)}for(let t=0;t<this.body.length;t++)o+=this.body[t].len;for(let e=0;e<t.body.length;e++)n+=t.body[e].len;console.log(t.body,i,t.body[i]),e=this.body[r].len*e,s=t.body[i].len*s;for(let t=0;t<r;t++)e+=this.body[t].len;for(let e=0;e<i;e++)s+=t.body[e].len;return{s:e/o,t:s/n}}len(){return this.body.reduce((t,e)=>t+e.len,0)}}s.d(e,"a",function(){return h});class h extends r.a{constructor(t){super(a,t),this.update()}at(t){return this.body[t.curve].at(t.r)}sample(t){return this.body.map(function(e){return e.sample(t)})}}},function(t,e,s){"use strict";s.r(e);var r=80;function i(t){return t.match(/[ @]/)?'"'+t+'"':t}function o(t,e){return(0==e?"@ ":"  ")+t}function n(t,e){return(0==e?"# ":"  ")+t}function a(t,e,s){var o=Object.keys(t),a=o.map(r=>({key:r,val:e(t[r],s-r.length)})),h=a.map(t=>t.val.some(t=>t.includes("@")||t.includes("#"))).some(t=>t),c=a.map(t=>i(t.key)+": "+t.val[0]).join(" "),d=h||c.length>s,u=a.map(t=>t.val.map((e,s)=>(function(t,e,s){var r=i(s);return(0==e?r+": ":" ".repeat(r.length+2))+t})(e,s,t.key))).flatten(),l=u.some(t=>t.length>r),p=o.map(r=>({key:r,val:e(t[r],s-2)})).map(t=>(function(t,e){return[e+":"].concat(t.map(t=>" "+t))})(t.val,t.key)).flatten();return l?p.map(n):d?u.map(n):["# "+c]}function h(t,e){switch(typeof t){case"string":return[i(t)];case"number":return[t.toString()];case"object":return Array.isArray(t)?function(t,e,s){var r=t.map(t=>e(t,s-2)).flatten(),i=r.join(" ");return r.some(t=>t.includes("@")||t.includes("#"))||i.length>s?r.map(o):["@ "+i]}(t,h,e):a(t,h,e)}}function c(t){return{"{":"}","[":"]",":":""}[t[t.length-1].type]}function d(t){return t.split("\n").map(t=>t.replace(/(\S+\s*)(?=:)/g,'<span class="key">$1</span>').replace(/([#@:])/g,'<span class="keyword">$1</span>')).join("\n")}Array.prototype.flatten=function(){return[].concat(...this)},Array.prototype.last=function(){return this[this.length-1]};class u{constructor(t){this.input=document.getElementById("stroke-list"),this.strokeBase=t,this.init()}init(){var t=this;window.addEventListener("keyup",function(e){"Enter"===e.key&&e.ctrlKey&&e.shiftKey?(t.strokeBase.submit(t.input.value),t.strokeBase.save()):"Enter"===e.key&&e.ctrlKey?t.strokeBase.submit(t.input.value):t.highlight()})}highlight(){this.input.style.height=this.input.scrollHeight;var t=this.input.value;document.getElementById("code-display").innerHTML=d(t)}update(t){this.input.value=t,this.highlight()}}var l=s(5);var p=document.getElementById("canvas"),_=document.getElementById("canvas").getContext("2d"),y=window.devicePixelRatio;p.style.width=p.width+"px",p.style.height=p.height+"px",p.width=p.width*y,p.height=p.height*y,_.scale(y,y),new class{constructor(t){this.base={},this.ctx=t,this.input=new u(this),this.currCharName=""}updateBase(){new Promise(function(t,e){var s=new XMLHttpRequest;s.open("GET","data/stroke-spec.json",!0),s.onload=function(){this.status>=200&&this.status<300?t(s.response):e({status:this.status,statusText:s.statusText})},s.onerror=function(){e({status:this.status,statusText:s.statusText})},s.send()}).then(function(t){this.base=JSON.parse(t),this.updateUI(this.base)}.bind(this))}updateUI(t){var e=document.getElementById("char-list");for(let r in t)if("radical"==t[r].type){var s=document.createElement("button");s.appendChild(document.createTextNode(r)),s.classList.add("char-button"),s.onclick=function(t){this.getStroke(r),this.currCharName=r,this.input.update(this.getStrokeSpecText(r))}.bind(this),e.appendChild(s)}}submit(){var t=document.getElementById("stroke-list").value,e=JSON.parse(function(t){var e=t.split("\n").filter(t=>!t.match(/^\s*$/));console.log(e);var s="",r=[],i=0;for(let t=0;t<e.length;t++){for(var o=e[t].search(/\S|$/);r.length>0&&r[r.length-1].indent>=o;)s+=c(r),r.pop();i=0;for(var n=e[t];n.length>0;)switch(n[0]){case" ":r[r.length-1].comma?s+=", ":r[r.length-1].comma=!0,i+=n.search(/\S|$/),n=n.trim();break;case"@":s+="[",r.push({type:"[",indent:i,comma:!1}),i+=1,n=n.slice(1);break;case"#":s+="{",r.push({type:"{",indent:i,comma:!1}),i+=1,n=n.slice(1);break;case":":s+=":",r.push({type:":",indent:i}),i+=1,n=n.slice(1);break;case'"':var a=n.match(/"(?:\\"|[^"])*"/);if(!a)throw"Quoted string missing at Line: "+t;r.length>0&&":"==r[r.length-1].type&&r.pop(),i+=a[0].length,s+=n.slice(0,a[0].length),n=n.slice(a[0].length);break;default:var h=n.match(/[^\s:]*/);if(!h)throw"Simple string got some problem at Line: 1";r.length>0&&":"==r[r.length-1].type&&r.pop(),i+=h[0].length;var d=n.slice(0,h[0].length),u=parseFloat(d);s+=u||0==u?u:'"'+d+'"',n=n.slice(h[0].length)}}for(;r.length>0&&r[r.length-1].indent>=0;)s+=c(r),r.pop();return s}(t));this.base[this.currCharName]=e,this.getStroke(this.currCharName),this.base[this.currCharName].text=t}save(){(function(t){return new Promise(function(e,s){var r=new XMLHttpRequest;r.open("POST","save",!0),r.setRequestHeader("content-type","application/json"),r.onload=function(){this.status>=200&&this.status<300?e(r.response):s({status:this.status,statusText:r.statusText})},r.onerror=function(){s({status:this.status,statusText:r.statusText})},r.send(t)})})(JSON.stringify(this.base,null,2)).then(function(t){console.log("persisted")}).catch(function(t){console.log("error",t)})}getStrokeSpecText(t){return void 0===this.base[t].text?function(t){return h(t,r).join("\n")}(this.base[t]):this.base[t].text}getStrokeSpec(t){var e=this,s=function(t){return JSON.parse(JSON.stringify(t))}(this.base[t]);switch(s.type){case"radical":return s.body=s.body.reduce(function(t,s){var r=e.getStrokeSpec(s);return"radical"==r.type?t.concat(r.body):t.concat(r)},[]),s;case"compound":return s.body=s.body.reduce(function(t,s){var r=e.getStrokeSpec(s);return"compound"==r.type?t.concat(r.body):t.concat(r)},[]),s;case"simple":return{type:"compound",body:[s]}}}getStroke(t){var e=this.getStrokeSpec(t),s=new l.a(e);console.log("strokeSpec",e),s.draw(this.ctx),s.findCenterRect(this.ctx,10),s.findCentroid(this.ctx,15)}}(_).updateBase()}]);