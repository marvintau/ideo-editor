!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=5)}([function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s{constructor(t,e,i){void 0===i?(this.attr={},void 0===e?void 0===t?(this.x=0,this.y=0):void 0!==t.x&&void 0!==t.y?(this.x=t.x,this.y=t.y):"number"==typeof t&&(this.x=Math.cos(t*Math.PI/180),this.y=Math.sin(t*Math.PI/180)):(this.x=t,this.y=e)):(this.attr=i,this.x=t,this.y=e)}add(t){return new s(this.x+t.x,this.y+t.y)}iadd(t){this.x+=t.x,this.y+=t.y}sub(t){return new s(this.x-t.x,this.y-t.y)}isub(t){this.x-=t.x,this.y-=t.y}mult(t){return void 0===t.x?new s(this.x*t,this.y*t):new s(this.x*t.x,this.y*t.y)}imult(t){void 0===t.x?(this.y*=t,this.x*=t):(this.x*=t.x,this.y*=t.y)}neg(){return new s(-this.x,-this.y)}cross(t){return this.x*t.y-t.x*this.y}head(t){return new s(Math.min(this.x,t.x),Math.min(this.y,t.y))}isHeaderTo(t){return this.x<t.x&&this.y<t.y}tail(t){return new s(Math.max(this.x,t.x),Math.max(this.y,t.y))}isTailerTo(t){return this.x>t.x&&this.y>t.y}mag(){return Math.hypot(this.x,this.y)}angle(){return Math.atan2(this.y,this.x)/Math.PI*180}sampleTo(t,e){var i=[],s=t.sub(this);for(let t=0;t<e;t++)i.push(this.add(s.mult((t+.5)/e)));return i}sampleStepTo(t,e){var i=[],s=t.sub(this),r=s.mag();for(let t=0;t<r;t+=e)i.push(this.add(s.mult(t/r)));return i.push(t),i}isNaN(){return isNaN(this.x)||isNaN(this.y)}addAttr(t){this.attr.push(t)}setAttr(t){Object.assign(this.attr,t)}removeAttr(t){this.attr[t]=void 0}copy(){return new s(this.x,this.y,JSON.parse(JSON.stringify(this.attr)))}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return CurveStructureBase});var _Vec_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_Box_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2);class CurveStructureBase{constructor(t,e){this.body=void 0===e||void 0===e.body?[]:e.body.map(e=>new t(e)),this.head=void 0===e||void 0===e.head?new _Vec_js__WEBPACK_IMPORTED_MODULE_0__.a:e.head,this.prog=void 0===e||void 0===e.prog?[]:e.prog,this.vars=void 0===e||void 0===e.vars?{}:e.vars,this.box=new _Box_js__WEBPACK_IMPORTED_MODULE_1__.a}static intersect(t,e){if(t.prototype.constructor!==e.prototype.constructor)throw new Exception;for(let i=0;i<t.body.length;i++)for(let t=0;t<e.body.length;t++);}rotate(t,e){void 0===e&&(e=0);for(let i=e;i<this.body.length;i++)this.body[i].rotate(t);this.update()}scale(t,e){void 0===e&&(e=0);for(let i=e;i<this.body.length;i++)this.body[i].scale(t);this.update()}trans(t){this.head=this.head.add(t),this.update()}len(){return this.body.reduce((t,e)=>t+e.len(),0)}getVariable(item){switch(typeof item){case"number":return item;case"string":if(item in this.vars){if("string"==typeof this.vars[item]&&this.vars[item].match(/@'\S*'/)){let s=this.vars[item].replace(/@'([^']*)'/g,"this.getVariable('$1')");return eval(s)}return this.vars[item].val}if(item.match(/@'\S*'/)){let s=item.replace(/@'([^']*)'/g,"this.getVariable('$1')");return eval(s)}throw{error:"ValueError",message:"item "+item+"is neither an existing variable or an expression"};case"object":let o={};for(let t in item)o[t]=this.getVariable(item[t]);return o;default:console.error("Key not found",item,typeof item)}}modify(t,e){e=void 0===e?this.vars:Object.assign(this.vars,e),void 0===t&&(t=this.prog);for(let t of this.body)t.modify(void 0,e);for(let e of t)for(let t in e){var i=void 0===e.ith?this:this.body[e.ith];"prog"!=t?i[t](this.getVariable(e[t])):i.modify(e[t])}this.update()}ith(){}update(){if(this.body.length>0&&(this.body[0].head=this.head.copy(),this.body[0].update(),this.box=this.body[0].box,this.tail=this.body[0].tail),this.body.length>1)for(let t=1;t<this.body.length;t++)try{this.body[t].head=this.body[t-1].tail.copy(),this.body[t].update(),this.tail=this.body[t].tail,this.box=this.box.union(this.body[t].box)}catch(t){}}copy(){var t=new this.constructor;return t.body=this.body.map(t=>t.copy()),t.head=this.head.copy(),t}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(0);class r{constructor(t,e){void 0===e&&(e=new s.a),void 0===t&&(t=new s.a),this.head=t.copy(),this.tail=e.copy()}union(t){var e=this.head.head(t.head),i=this.tail.tail(t.tail);return new r(e,i)}copy(){return new r(this.head.copy(),this.tail.copy())}center(){return this.head.add(this.tail).mult(new s.a(.5,.5))}size(){return this.tail.sub(this.head)}include(t){return t.isTailerTo(this.head)&&t.isHeaderTo(this.tail)}moveWithHead(t){var e=this.size();return new r(t,t.add(e))}set(t,e,i,s){this.head.x=t,this.head.y=e,this.tail.x=t+i,this.tail.y=e+s}draw(t){var e=this.size();t.lineWidth=1,t.beginPath(),t.rect(this.head.x,this.head.y,e.x,e.y),t.stroke()}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Char});var _Vec_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_Box_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_Radical_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4),_Core_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(6);class Char{constructor(t){if(this.body=[],t&&t.body)for(let e of t.body)"Radical"===e.type?this.body.push(new _Radical_js__WEBPACK_IMPORTED_MODULE_2__.a(e)):"Char"===e.type&&this.body.push(new Char(e));this.head=void 0===t||void 0===t.head?new _Vec_js__WEBPACK_IMPORTED_MODULE_0__.a:t.head,this.prog=void 0===t||void 0===t.prog?[]:t.prog,this.vars=void 0===t||void 0===t.vars?{}:t.vars,this.box=new _Box_js__WEBPACK_IMPORTED_MODULE_1__.a,this.modify(),this.toPointList()}cross(t){var e=this.body[t.dest.ith].at(t.dest),i=this.body[t.self.ith].at(t.self);this.body[t.self.ith].trans(e.sub(i))}place(t){var e=this.body[t.self.ith].box,i=this.body[t.dest.ith].box,s=i.center();switch(t.pos){case 0:s.x+=e.size().add(i.size()).mult(.5).x,s=s.sub(e.center());break;case 1:s.y+=e.size().add(i.size()).mult(.5).y,s=s.sub(e.center())}console.log(i.center(),e.center().sub(i.center()),"center"),this.body[t.self.ith].trans(s),this.update()}modify(t,e){e=void 0===e?this.vars:Object.assign(this.vars,e),void 0===t&&(t=this.prog);for(let t of this.body)t.modify(void 0,e);for(let e of t)for(let t in e){var i=void 0===e.ith?this:this.body[e.ith];"prog"!=t?i[t](this.getVariable(e[t])):i.modify(e[t])}this.update()}update(){if(this.body.length>0&&(this.body[0].update(),this.box=this.body[0].box),this.body.length>1)for(let t=1;t<this.body.length;t++)this.body[t].update(),this.box=this.box.union(this.body[t].box)}getVariable(item){switch(typeof item){case"number":return item;case"string":if(item in this.vars){if("string"==typeof this.vars[item]&&this.vars[item].match(/@'\S*'/)){let s=this.vars[item].replace(/@'([^']*)'/g,"this.getVariable('$1')");return eval(s)}return this.vars[item].val}if(item.match(/@'\S*'/)){let s=item.replace(/@'([^']*)'/g,"this.getVariable('$1')");return eval(s)}throw{error:"ValueError",message:"item "+item+"is neither an existing variable or an expression"};case"object":let o={};for(let t in item)o[t]=this.getVariable(item[t]);return o;default:console.error("Key not found",item,typeof item)}}toPointList(){this.points=[];for(let t of this.body)this.points=this.points.concat(t.toPointList());this.core={};let t=[];for(let e of this.body)t=t.concat(e.core.convex);return this.core.convex=Object(_Core_js__WEBPACK_IMPORTED_MODULE_3__.a)(t),this.core.area=Object(_Core_js__WEBPACK_IMPORTED_MODULE_3__.c)(this.core.convex),this.points}draw(t,e,i){for(let s of this.body)s.draw(t,e,i)}}},function(t,e,i){"use strict";var s=i(1),r=i(6),a=i(0),n=i(2);class o extends s.a{constructor(t){super(),this.len=t&&t.len?t.len:0,this.ang=t&&t.ang?t.ang:0,this.head=new a.a,this.tail=new a.a,this.box=new n.a,this.update()}static intersect(t,e){var i=t.head,s=t.tail,r=e.head,a=e.tail,n=i.sub(r).cross(r.sub(a)),o=-i.sub(s).cross(i.sub(r)),h=i.sub(s).cross(r.sub(a)),c=n/h,u=o/h;return{p:i.add(s.sub(i).mult(c)),s:c,t:u,s1:t.splitAt(c),s2:e.splitAt(u)}}copy(){return new o({len:this.len,ang:this.ang,head:this.head})}at(t){return this.head.add(this.tail.sub(this.head).mult(t))}setLenAngFromEnds(){var t=this.tail.sub(this.head);this.len=t.mag(),this.ang=t.angle()}splitAt(t){var e=[new o,new o],i=this.splitAt(t);return e[0].head=this.head,e[0].tail=e[1].head=i,e[1].tail=this.tail,e[0].setLenAngFromEnds(),e[1].setLenAngFromEnds(),e}splitAtLength(t){return this.splitAt(this.len/t)}rotate(t){this.ang+=t,this.update()}trans(t){this.head=this.head.add(new a.a(t)),this.update()}scale(t){this.len*=t,this.update()}modify(t){t=void 0===t?this.prog:this.prog.concat(t);for(let e of t)switch(Object.keys(e)[0]){case"trans":this.trans(e.trans);break;case"rotate":this.rotate(e.rotate);break;case"stretch":this.stretch(e.scale)}this.update()}update(){var t=new a.a(this.ang);this.tail=this.head.add(t.mult(this.len));var e=this.head.head(this.tail),i=this.tail.tail(this.head);this.box=new n.a(e,i)}}class h extends s.a{constructor(t){super(o,t),this.update()}at(t){for(var e=t*this.body.reduce((t,e)=>t+e.len,0),i=0,s=null,r=0;r<this.body.length&&!(i+(s=this.body[r]).len>=e);r++)i+=this.body[r].len;return s.at((e-i)/s.len)}splitSegAt(t){let e=this.body.reduce((t,e)=>t+e.len,0);return this.splitSegAtLength(t*e)}splitSegAtLength(t){for(var e=0,i=0;i<this.body.length;i++){if(e+this.body[i].len>t){this.body=[].concat(this.body.slice(0,i-1),this.body[i].splitAtLength(t-e),this.body.slice(i+1));break}e+=this.body[i].len}return i}mergeSegAt(){}curl(t){var e=0;for(let i=0;i<this.body.length;i++)this.body[i].ang+=e,e+=t;this.update()}draw(t,e,i){t.moveToVec(this.body[0].head,i);for(var s=0;s<this.body.length;s++)this.body.length-s>2?(t.bezierCurveToVec(this.body.slice(s,s+3).map(t=>t.tail),i),s+=2):(t.lineToVec(this.body[s].tail,i),s+=1)}}class c extends s.a{constructor(t){super(h,t),this.update()}curl(t){1==this.body.length&&this.body[0].curl(t)}at(t){return this.body[t.curve].at(t.r)}toPointList(){var t=[this.body[0].body[0].head];for(let i=0;i<this.body.length;i++){var e=this.body[i].body;for(let i=1;i<e.length;i++)t.push(e[i].head);i!=this.body.length-1&&(e[e.length-1].tail.attr.intersect=!0),t.push(e[e.length-1].tail)}return[t]}draw(t,e,i){t.lineWidth=e,t.lineCap="square",t.lineJoin="miter",t.miterLimit=3,t.strokeStyle="black",t.beginPath();for(let s of this.body)s.draw(t,e,i);t.stroke()}}i.d(e,"a",function(){return u});class u extends s.a{constructor(t){super(c,t)}at(t){this.body[t.stroke].at(t)}cross(t){var e=this.body[t.dest.ith].at(t.dest),i=this.body[t.self.ith].at(t.self);this.body[t.self.ith].trans(e.sub(i))}update(){if(this.body.length>0&&(this.body[0].head.iadd(this.head),this.body[0].update(),this.box=this.body[0].box),this.body.length>1)for(let t=1;t<this.body.length;t++)this.body[t].head.iadd(this.head),this.body[t].update(),this.box=this.box.union(this.body[t].box);this.head=new a.a}toPointList(){this.points=[];for(let t of this.body)this.points=this.points.concat(t.toPointList());return this.core=Object(r.b)(this.points),this.points}draw(t,e,i){for(let s of this.body)s.draw(t,e,i)}}},function(t,e,i){"use strict";i.r(e);var s=120;function r(t){return t.match(/[ @]/)?'"'+t+'"':t}function a(t,e){return(0==e?"@ ":"  ")+t}function n(t,e){return(0==e?"# ":"  ")+t}function o(t,e,i){var a=Object.keys(t),o=a.map(s=>({key:s,val:e(t[s],i-s.length)})),h=o.map(t=>t.val.some(t=>t.includes("@")||t.includes("#"))).some(t=>t),c=o.map(t=>r(t.key)+": "+t.val[0]).join(" "),u=h||c.length>i,l=o.map(t=>t.val.map((e,i)=>(function(t,e,i){var s=r(i);return(0==e?s+": ":" ".repeat(s.length+2))+t})(e,i,t.key))).flatten(),d=l.some(t=>t.length>s),p=a.map(s=>({key:s,val:e(t[s],i-2)})).map(t=>(function(t,e){return[e+":"].concat(t.map(t=>" "+t))})(t.val,t.key)).flatten();return d?p.map(n):u?l.map(n):["# "+c]}function h(t,e){switch(typeof t){case"string":return[r(t)];case"number":return[t%1==0?t.toString():t.toFixed(3)];case"object":return Array.isArray(t)?function(t,e,i){var s=t.map(t=>e(t,i-2)).flatten(),r=s.join(" ");return s.some(t=>t.includes("@")||t.includes("#"))||r.length>i?s.map(a):["@ "+r]}(t,h,e):o(t,h,e)}}function c(t){return h(t,s).join("\n")}function u(t){return{"{":"}","[":"]",":":""}[t[t.length-1].type]}function l(t){return t.split("\n").map(t=>t.replace(/(\S+\s*)(?=:)/g,'<span class="key">$1</span>').replace(/([#@:])/g,'<span class="keyword">$1</span>')).join("\n")}Array.prototype.flatten=function(){return[].concat(...this)},Array.prototype.last=function(){return this[this.length-1]};class d{constructor(t){this.input=document.getElementById("stroke-list"),this.strokeBase=t,this.init()}init(){var t=this;window.addEventListener("keyup",function(e){"Enter"===e.key&&e.ctrlKey&&e.shiftKey?(t.strokeBase.submit(t.input.value),t.strokeBase.save()):"Enter"===e.key&&e.ctrlKey?t.strokeBase.submit(t.input.value):t.highlight()})}highlight(){this.input.style.height=this.input.scrollHeight;var t=this.input.value;document.getElementById("code-display").innerHTML=l(t)}update(t){this.input.value=t,this.highlight()}}function p(t,e){let i=function(t){return JSON.parse(JSON.stringify(t))}(e[t]);switch(delete i.text,i.type){case"Char":case"Radical":return i.body=i.body.reduce(function(t,i){return t.concat(p(i,e))},[]),console.log(i.body,"getSpecRecursive"),i;case"Curve":return{type:"Stroke",body:[i]};case"Stroke":return i.body=i.body.reduce(function(t,i){return t.concat(p(i,e).body)},[]),i}}function b(t,e,i){var s=document.createElement("INPUT");return s.setAttribute("type","range"),s.classList.add("slider"),s.setAttribute("name",t),s.setAttribute("min",e.range.min),s.setAttribute("max",e.range.max),s.setAttribute("value",e.val),s.setAttribute("step",.001),s.addEventListener("input",i),s.addEventListener("change",i),s}function y(t){var e=document.createElement("label");return e.innerHTML=t,e.setAttribute("for",t),e}function f(t,e,i){var s=document.createElement("div");return s.appendChild(y(t)),void 0!=e.val&&(s.appendChild(b(t,e,i)),s.appendChild(function(t,e){var i=document.createElement("SPAN");return i.setAttribute("id",t+"-indicator"),i.classList.add("indicator"),i.innerText=e,i}(t,e.val))),s}var m=i(3);i(6);function g(t,e,i,s){void 0===s&&(s={lineWidth:1.5,strokeStyle:"rgb(192, 64, 0, 0.7)"}),Object.assign(t,s);var r=e.size(),a=e.center();t.beginPath(),t.rect(e.head.x*i,e.head.y*i,r.x*i,r.y*i),t.stroke(),t.beginPath(),t.arc(a.x*i,a.y*i,3,0,2*Math.PI),t.stroke(),t.translate(128,128)}CanvasRenderingContext2D.prototype.moveToVec=function(t,e){this.moveTo(t.x*e,t.y*e)},CanvasRenderingContext2D.prototype.lineToVec=function(t,e){this.lineTo(t.x*e,t.y*e)},CanvasRenderingContext2D.prototype.bezierCurveToVec=function(t,e){3==t.length&&this.bezierCurveTo(t[0].x*e,t[0].y*e,t[1].x*e,t[1].y*e,t[2].x*e,t[2].y*e)};(new class{constructor(){this.base={},this.input=new d(this),this.currCharName="",this.currSpec={},this.preview=document.getElementById("preview").getContext("2d"),this.shouldShowStrokes=!1,document.getElementById("create").onclick=function(t){this.create()}.bind(this),document.getElementById("show-stroke").onclick=function(t){this.shouldShowStrokes=!this.shouldShowStrokes,this.updateCharList(this.base)}.bind(this),document.getElementById("generate-spec").onclick=function(t){this.suggest()}.bind(this),document.getElementById("replace-vars").onclick=function(t){this.replaceVars()}.bind(this)}initStroke(t){this.getStrokeSpec(t),this.initVariableControls(),this.char=new m.a(this.currSpec),this.updateWithPoint()}updateStroke(){this.char=new m.a(this.currSpec),this.updateWithPoint()}updateBase(){new Promise(function(t,e){var i=new XMLHttpRequest;i.open("GET","data/stroke-spec.json",!0),i.onload=function(){this.status>=200&&this.status<300?t(i.response):e({status:this.status,statusText:i.statusText})},i.onerror=function(){e({status:this.status,statusText:i.statusText})},i.send()}).then(function(t){this.base=JSON.parse(t),this.updateCharList(this.base)}.bind(this))}updateCharList(t){for(var e=document.getElementById("char-list");e.firstChild;)e.removeChild(e.firstChild);for(let s in t)if(this.shouldShowStrokes||"Radical"===this.base[s].type||"Char"===this.base[s].type){var i=document.createElement("button");i.appendChild(document.createTextNode(s)),i.classList.add("char-button"),i.onclick=function(t){this.currCharName=s,this.initStroke(s),this.input.update(this.getStrokeSpecText(s))}.bind(this),e.appendChild(i)}}submit(){var t=document.getElementById("stroke-list").value,e=JSON.parse(function(t){var e=t.split("\n").filter(t=>!t.match(/^\s*$/)),i="",s=[],r=0;for(let t=0;t<e.length;t++){for(var a=e[t].search(/\S|$/);s.length>0&&s[s.length-1].indent>=a;)i+=u(s),s.pop();r=0;for(var n=e[t];n.length>0;)switch(n[0]){case" ":s[s.length-1].comma?i+=", ":s[s.length-1].comma=!0,r+=n.search(/\S|$/),n=n.trim();break;case"@":i+="[",s.push({type:"[",indent:r,comma:!1}),r+=1,n=n.slice(1);break;case"#":i+="{",s.push({type:"{",indent:r,comma:!1}),r+=1,n=n.slice(1);break;case":":i+=":",s.push({type:":",indent:r}),r+=1,n=n.slice(1);break;case'"':var o=n.match(/"(?:\\"|[^"])*"/);if(!o)throw"Quoted string missing at Line: "+t;s.length>0&&":"==s[s.length-1].type&&s.pop(),r+=o[0].length,i+=n.slice(0,o[0].length),n=n.slice(o[0].length);break;default:var h=n.match(/[^\s:]*/);if(!h)throw"Simple string got some problem at Line: 1";s.length>0&&":"==s[s.length-1].type&&s.pop(),r+=h[0].length;var c=n.slice(0,h[0].length),l=parseFloat(c);i+=l||0==l?l:'"'+c+'"',n=n.slice(h[0].length)}}for(;s.length>0&&s[s.length-1].indent>=0;)i+=u(s),s.pop();return i}(t));this.base[this.currCharName]=e,this.initStroke(this.currCharName)}save(){var t=JSON.stringify(this.base,null,2),e=this.currCharName;(function(t){return new Promise(function(e,i){var s=new XMLHttpRequest;s.open("POST","save",!0),s.setRequestHeader("content-type","application/json"),s.onload=function(){this.status>=200&&this.status<300?e(s.response):i({status:this.status,statusText:s.statusText})},s.onerror=function(){i({status:this.status,statusText:s.statusText})},s.send(t)})})(t).then(function(t){document.getElementById("indicator").innerText="『"+e+"』字编辑已然保存"}).catch(function(t){console.log("error",t)})}create(){var t=document.getElementById("new-char-name").value;void 0!==this.base[t]?document.getElementById("indicator").innerText="『"+t+"』字已然存在了":(this.base[t]={type:"Radical",body:[],vars:{},prog:[]},"~"==t[0]&&(this.base[t].unnamed="true"),this.currCharName=t,this.currSpec=this.base[t],this.updateCharList(this.base))}suggest(){this.submit(),this.getStrokeSpec(this.currCharName),this.base[this.currCharName]=suggestSpec(this.base[this.currCharName],this.currSpec),this.base[this.currCharName].text=c(this.base[this.currCharName]),this.input.update(this.base[this.currCharName].text),this.initStroke(this.currCharName)}replaceVars(){delete this.base[this.currCharName].text,console.log(this.base[this.currCharName]),this.base[this.currCharName]=replaceVariables(this.base[this.currCharName]),this.base[this.currCharName].text=c(this.base[this.currCharName]),this.input.update(this.base[this.currCharName].text),this.initStroke(this.currCharName)}getStrokeSpec(t){var e=this.base[t].type;document.getElementById("indicator").innerText="载入"+{Char:"全字",Radical:"部首",Compound:"笔画",Curve:"简单笔画"}[e]+"『"+t+"』",this.currSpec=function(t,e){var i=e[t];if(console.log(e),"Stroke"==i.type&&(i={type:"Radical",vars:{},body:[p(t,e)]}),"Radical"==i.type){i={type:"Char",vars:{},body:[p(t,e)]};for(let t of i.body)for(let e in t.vars)i.vars[e]=t.vars[e]}else"Char"==i.type&&(console.log("getSpec",i.type),i=p(t,e));return i}(t,this.base),console.log("currSpec",this.currSpec)}getStrokeSpecText(t){return this.base[t].text&&delete this.base[t].text,c(this.base[t])}initVariableControls(){let t=document.getElementById("var-bars");for(;t.firstChild;)t.removeChild(t.firstChild);let e=document.createElement("div");if(e.appendChild(y("笔画宽度")),this.strokeWidth=8,e.appendChild(b(name,{val:4,range:{min:1,max:15}},function(t){this.strokeWidth=parseFloat(t.target.value),this.updateStroke()}.bind(this))),t.appendChild(e),this.currSpec.vars)for(let e in this.currSpec.vars)t.appendChild(f(e,this.currSpec.vars[e],function(t){void 0!=this.currSpec.vars[e].val&&(this.currSpec.vars[e].val=parseFloat(t.target.value),document.getElementById(t.target.name+"-indicator").innerText=this.currSpec.vars[e].val),this.base[this.currCharName].vars=this.currSpec.vars,this.input.update(c(this.base[this.currCharName])),this.updateStroke()}.bind(this)))}updateWithPoint(){let t=this.char.points,e=this.char.box.center();if(t.length>0){let t=this.preview.canvas.width,i=this.preview.canvas.height;this.preview.clearRect(0,0,t,i),function(t,e,i,s){void 0===s&&(s={lineWidth:1,strokeStyle:"rgb(0, 0, 0, 0.2)"}),Object.assign(t,s),t.beginPath(),t.rect(.05*e,.05*i,.9*e,.9*i);for(let s=2;s<5;s++)t.moveTo(0,s*e/6),t.lineTo(i,s*e/6),t.moveTo(s*i/6,0),t.lineTo(s*i/6,e);t.stroke()}(this.preview,t,i),this.preview.translate(128-16*e.x,128-16*e.y),console.log(this.char),this.char.draw(this.preview,this.strokeWidth,16),function(t,e,i,s){t.fillStyle=s;let r=e.convex;t.beginPath(),t.moveToVec(r[0],i);for(let e=1;e<r.length;e++)t.lineToVec(r[e],i);t.closePath(),t.fill()}(this.preview,this.char.core,16,"rgb(64, 32, 32, 0.4)");for(let t of this.char.body)g(this.preview,t.box,16);this.preview.setTransform(1,0,0,1,0,0)}}}).updateBase()},function(t,e,i){"use strict";i.d(e,"a",function(){return n}),i.d(e,"c",function(){return o}),i.d(e,"b",function(){return h});i(0);function s(t,e,i,s,r){return function(t,e,i,s){var r=t.sub(i).cross(i.sub(s)),a=-t.sub(e).cross(t.sub(i)),n=t.sub(e).cross(i.sub(s)),o=r/n,h=a/n,c=t.add(e.sub(t).mult(o)),u=t.add(e.sub(t).mult(o));return c.setAttr({intersect:!0}),u.setAttr({intersect:!0}),{p:c,q:u,s:o,t:h}}(t[e][s],t[e][s+1],t[i][r],t[i][r+1])}function r(t){return function(t){for(let i=0;i<t.length;i++){var e=[[]];for(let s=0;s<t[i].length;s++)e.last().push(t[i][s]),t[i][s].attr.intersect&&e.push([t[i][s].copy()]);t[i]=e}return t}(function(t){for(let a=0;a<t.length;a++)for(let n=0;n<a;n++)for(let o=0;o<t[a].length-1;o++)for(let h=0;h<t[n].length-1;h++){var e=s(t,a,n,o,h),i=e.s>0&&e.s<1,r=e.t>0&&e.t<1;i&&r&&(t[a].splice(1+o++,0,e.p),t[n].splice(1+h++,0,e.q))}return t}(t.map(t=>t.slice(0).map(t=>t.copy()))))}function a(t,e){return function(t,e,i){return e.sub(t).cross(i.sub(t))}(t[t.length-2],t[t.length-1],e)}function n(t){t.sort(function(t,e){return t.x==e.x?t.y-e.y:t.x-e.x});for(var e=[],i=0;i<t.length;i++){for(;e.length>=2&&a(e,t[i])<=0;)e.pop();e.push(t[i])}var s=[];for(i=t.length-1;i>=0;i--){for(;s.length>=2&&a(s,t[i])<=0;)s.pop();s.push(t[i])}return s.pop(),e.pop(),e.concat(s)}function o(t){var e=t.slice(0).concat(t[0]),i=0;for(let t=0;t<e.length-1;t++)i+=e[t].cross(e[t+1])/2;return Math.abs(i)}function h(t){let e=r(t);var i=[],s=[];for(let t=0;t<e.length;t++)for(let r=0;r<e[t].length;r++){let a=e[t][r];a[0].attr.intersect&&a.last().attr.intersect&&(i=i.concat(a)),s=s.concat(a)}let a=n(s),h=o(a),c=(Math.sqrt(2*h/Math.PI),[]);for(let t=0;t<e.length;t++)for(let i=0;i<e[t].length;i++){let s=e[t][i];if(!s[0].attr.intersect||!s.last().attr.intersect){var u=0;for(let t=0;t<s.length-1;t++)u+=s[t].sub(s[t+1]).mag();c.push(u)}}return{convex:a,area:h}}Array.prototype.sum=function(){return 0==this.length?0:this.reduce((t,e)=>t+e)},Array.prototype.mean=function(){return this.sum()/this.length},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.last=function(){return this[this.length-1]}}]);