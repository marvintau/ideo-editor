!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=3)}([function(t,e,s){"use strict";s.d(e,"a",function(){return i});class i{constructor(t,e,s){void 0===s?(this.attr={},void 0===e?void 0===t?(this.x=0,this.y=0):void 0!==t.x&&void 0!==t.y?(this.x=t.x,this.y=t.y):"number"==typeof t&&(this.x=Math.cos(t*Math.PI/180),this.y=Math.sin(t*Math.PI/180)):(this.x=t,this.y=e)):(this.attr=s,this.x=t,this.y=e)}add(t){return new i(this.x+t.x,this.y+t.y)}iadd(t){this.x+=t.x,this.y+=t.y}sub(t){return new i(this.x-t.x,this.y-t.y)}isub(t){this.x-=t.x,this.y-=t.y}mult(t){return void 0===t.x?new i(this.x*t,this.y*t):new i(this.x*t.x,this.y*t.y)}imult(t){void 0===t.x?(this.y*=t,this.x*=t):(this.x*=t.x,this.y*=t.y)}polar(t){return new i(this.x+t.len*Math.cos(t.ang*Math.PI/180),this.y+t.len*Math.sin(t.ang*Math.PI/180))}ipolar(t){this.x+=t.len*Math.cos(t.ang*Math.PI/180),this.y+=t.len*Math.sin(t.ang*Math.PI/180)}iscale(t,e){this.isub(e),this.imult(t),this.iadd(e)}rotate(t){let e=t/180*Math.PI,s=Math.sin(e),r=Math.cos(e);return new i(this.x*r-this.y*s,this.x*s+this.y*r)}irotate(t){let e=this.rotate(t);this.x=e.x,this.y=e.y}neg(){return new i(-this.x,-this.y)}cross(t){return this.x*t.y-t.x*this.y}head(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))}isHeaderTo(t){return this.x<t.x&&this.y<t.y}tail(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))}isTailerTo(t){return this.x>t.x&&this.y>t.y}mag(){return Math.hypot(this.x,this.y)}angle(){return Math.atan2(this.y,this.x)/Math.PI*180}sampleTo(t,e){var s=[],i=t.sub(this);for(let t=0;t<e;t++)s.push(this.add(i.mult((t+.5)/e)));return s}sampleStepTo(t,e){var s=[],i=t.sub(this),r=i.mag();for(let t=0;t<r;t+=e)s.push(this.add(i.mult(t/r)));return s.push(t),s}isNaN(){return isNaN(this.x)||isNaN(this.y)}addAttr(t){this.attr.push(t)}setAttr(t){return Object.assign(this.attr,t)}removeAttr(t){this.attr[t]=void 0}copy(){return new i(this.x,this.y,JSON.parse(JSON.stringify(this.attr)))}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return CurveStructureBase});var _Vec_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_Box_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2);class CurveStructureBase{constructor(t){this.type="CurveStructureBase",this.prog=void 0===t||void 0===t.prog?[]:t.prog,this.vars=void 0===t||void 0===t.vars?{}:t.vars,this.box=new _Box_js__WEBPACK_IMPORTED_MODULE_1__.a}getInnerRatio(t){if(this.body.length<1)throw"empty structure has no inner ratio";var e=t*this.len(),s=0,i=0;if(t<0)return{index:0,ratio:e/this.body[0].len()};for(;i<this.body.length&&!(s+this.body[i].len()>e);i++)s+=this.body[i].len();return{index:i,ratio:(e-s)/this.body[i].len()}}scale(t){for(let e of this.body)e.scale(t);this.update()}trans(t){for(let e of this.body)e.trans(t);this.update()}length(){return this.body.reduce((t,e)=>t+e.length(),0)}stretch(t){let e=this.box.center(),s=this.flatten();for(let i of s)i.iscale(t,e);this.update()}getVariable(item){switch(typeof item){case"number":return item;case"string":if(item in this.vars){if("string"==typeof this.vars[item]&&this.vars[item].match(/@'\S*'/)){let s=this.vars[item].replace(/@'([^']*)'/g,"this.getVariable('$1')");return eval(s)}return this.vars[item].val}if(item.match(/@'\S*'/)){let s=item.replace(/@'([^']*)'/g,"this.getVariable('$1')");return eval(s)}throw{error:"ValueError",message:"item "+item+"is neither an existing variable or an expression"};case"object":if(Array.isArray(item))return item.map(function(t){return this.getVariable(t)}.bind(this));{let t={};for(let e in item)t[e]=this.getVariable(item[e]);return t}default:console.error("Key not found",item,typeof item)}}modify(t,e){e=void 0===e?this.vars:Object.assign(this.vars,e),void 0===t&&(t=this.prog);for(let t of this.body)t.modify(void 0,e);for(let e of t)for(let t in e){var s=void 0===e.ith?this:this.body[e.ith];if("prog"!=t)try{s[t](this.getVariable(e[t]))}catch(e){console.error("Type ["+s.type+"] doesn't contain method ["+t+"]")}else s.modify(e[t])}this.update()}ith(){}update(){this.preUpdate&&this.preUpdate();for(let t of this.body)t.update();if(this.duringUpdate&&this.duringUpdate(),this.body.length>0&&(this.box=this.body[0].box),this.body.length>1)for(let t=1;t<this.body.length;t++)this.box.iunion(this.body[t].box);this.postUpdate&&this.postUpdate()}flatten(){return this.body.flatten(t=>t.body,t=>t.body)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(0);class r{constructor(t,e){void 0===e&&(e=new i.a),void 0===t&&(t=new i.a),this.head=t.copy(),this.tail=e.copy()}union(t){var e,s;return t.x?(e=t,s=t):(e=t.head,s=t.tail),e=this.head.head(e),s=this.tail.tail(s),new r(e,s)}iunion(t){var e,s;t.x?(e=t,s=t):(e=t.head,s=t.tail),this.head=this.head.head(e),this.tail=this.tail.tail(s)}copy(){return new r(this.head.copy(),this.tail.copy())}center(){return this.head.add(this.tail).mult(new i.a(.5,.5))}size(){return this.tail.sub(this.head)}includeQ(t){return t.isTailerTo(this.head)&&t.isHeaderTo(this.tail)}moveWithHead(t){var e=this.size();return new r(t,t.add(e))}set(t,e,s,i){this.head.x=t,this.head.y=e,this.tail.x=t+s,this.tail.y=e+i}draw(t){var e=this.size();t.lineWidth=1,t.beginPath(),t.rect(this.head.x,this.head.y,e.x,e.y),t.stroke()}}},function(t,e,s){"use strict";s.r(e),Array.prototype.part=function(t,e){null==t&&(t=2),null==e&&(e=t);let s=[];for(let i=0;i<this.length-1;)s.push(this.slice(i,i+t)),i+=e;return s},Array.prototype.flatten=function(t,e){if(void 0!==e&&void 0!==t){const s=[...this],i=[];for(;s.length;){const r=s.pop();t(r)?s.push(...e(r)):i.push(r)}return i.reverse()}return[].concat(...this)},Array.prototype.sum=function(){return this.reduce((t,e)=>t+e,0)},Array.prototype.last=function(){return this[this.length-1]};var i=120;function r(t){return t.match(/[ @]/)?'"'+t+'"':t}function o(t,e){return(0==e?"@ ":"  ")+t}function n(t,e){return(0==e?"# ":"  ")+t}function a(t,e,s){var o=Object.keys(t),a=o.map(i=>({key:i,val:e(t[i],s-i.length)})),h=a.map(t=>t.val.some(t=>t.includes("@")||t.includes("#"))).some(t=>t),l=a.map(t=>r(t.key)+": "+t.val[0]).join(" "),d=h||l.length>s,u=a.map(t=>t.val.map((e,s)=>(function(t,e,s){var i=r(s);return(0==e?i+": ":" ".repeat(i.length+2))+t})(e,s,t.key))).flatten(),c=u.some(t=>t.length>i),y=o.map(i=>({key:i,val:e(t[i],s-2)})).map(t=>(function(t,e){return[e+":"].concat(t.map(t=>" "+t))})(t.val,t.key)).flatten();return c?y.map(n):d?u.map(n):["# "+l]}function h(t,e){switch(typeof t){case"string":return[r(t)];case"number":return[t%1==0?t.toString():t.toFixed(3)];case"object":return Array.isArray(t)?function(t,e,s){var i=t.map(t=>e(t,s-2)).flatten(),r=i.join(" ");return i.some(t=>t.includes("@")||t.includes("#"))||r.length>s?i.map(o):["@ "+r]}(t,h,e):a(t,h,e)}}function l(t){return h(t,i).join("\n")}function d(t){return{"{":"}","[":"]",":":""}[t[t.length-1].type]}function u(t){return t.split("\n").map(t=>t.replace(/(\S+\s*)(?=:)/g,'<span class="key">$1</span>').replace(/([#@:])/g,'<span class="keyword">$1</span>')).join("\n")}class c{constructor(t){this.input=document.getElementById("stroke-list"),this.strokeBase=t,this.init()}init(){var t=this;window.addEventListener("keyup",function(e){"Enter"===e.key&&e.ctrlKey&&e.shiftKey?(t.strokeBase.submit(t.input.value),t.strokeBase.save()):"Enter"===e.key&&e.ctrlKey?t.strokeBase.submit(t.input.value):t.highlight()})}highlight(){this.input.style.height=this.input.scrollHeight;var t=this.input.value;document.getElementById("code-display").innerHTML=u(t)}update(t){this.input.value=t,this.highlight()}}function y(t,e){let s=(i=e[t],JSON.parse(JSON.stringify(i)));var i;switch(delete s.text,s.type){case"Char":case"Radical":return s.body=s.body.reduce(function(t,s){return t.concat(y(s,e))},[]),s;case"Curve":return{type:"Stroke",body:[s]};case"Stroke":return s.body=s.body.reduce(function(t,s){return t.concat(y(s,e).body)},[]),s}}function p(t,e,s){var i=document.createElement("INPUT");return i.setAttribute("type","range"),i.classList.add("slider"),i.setAttribute("name",t),i.setAttribute("min",e.range.min),i.setAttribute("max",e.range.max),i.setAttribute("value",e.val),i.setAttribute("step",.001),i.addEventListener("input",s),i.addEventListener("change",s),i}function b(t){var e=document.createElement("label");return e.innerHTML=t,e.setAttribute("for",t),e}function f(t,e,s){var i=document.createElement("div");return i.appendChild(b(t)),null!=e.val&&(i.appendChild(p(t,e,s)),i.appendChild(function(t,e){var s=document.createElement("SPAN");return s.setAttribute("id",t+"-indicator"),s.classList.add("indicator"),s.innerText=e.toFixed(3),s}(t,e.val))),i}var m=s(1),g=s(0),v=s(2);class x extends m.a{constructor(t){if(super(t),this.type="Curve",this.body=[new g.a],this.body[0].setAttr({original:!0}),t)if(t.body)for(let e of t.body)this.body.push(this.body.last().polar(e)),this.body.last().setAttr({original:!0});else Array.isArray(t)&&(this.body=t);this.update()}trans(t){for(let e of this.body)e.iadd(t);this.update()}rotate(t){for(let e=1;e<this.body.length;e++)this.body[e].isub(this.body[0]),this.body[e].irotate(t),this.body[e].iadd(this.body[0]);this.update()}scale(t,e,s){void 0===s&&(s=this.body.length),void 0===e&&(e=0);for(let i=e+1;i<s;i++){let e=this.body[i].sub(this.body[i-1]),s=e.mult(t).sub(e);for(let t=i;t<this.body.length;t++)this.body[t].iadd(s)}this.update()}curl(t){if(this.body.length>1)for(let e=1;e<this.body.length;e++)this.body[e].isub(this.body[e-1]),this.body[e].irotate(t*(e-1)*(e-1)),this.body[e].iadd(this.body[e-1]);this.update()}length(){let t=0;for(let e=1;e<this.body.length;e++)t+=this.body[e].sub(this.body[e-1]).mag();return t}modify(t){void 0===t&&(t=this.prog);for(let e of t)for(let t in e)switch(t){case"scale":this.scale(e[t].ratio,e[t].from,e[t].to)}this.update()}update(){this.preUpdate&&this.preUpdate(),this.duringUpdate&&this.duringUpdate(),this.body.length>1&&(this.box=new v.a(this.body[0],this.body[1]));for(let t=1;t<this.body.length;t++)this.box.iunion(this.body[t]);this.postUpdate&&this.postUpdate()}convexHull(){const t=(t,e)=>((t,e,s)=>e.sub(t).cross(s.sub(t)))(t[t.length-2],t[t.length-1],e);this.body.sort(function(t,e){return t.x==e.x?t.y-e.y:t.x-e.x});for(var e=[],s=0;s<this.body.length;s++){for(;e.length>=2&&t(e,this.body[s])<=0;)e.pop();e.push(this.body[s])}var i=[];for(s=this.body.length-1;s>=0;s--){for(;i.length>=2&&t(i,this.body[s])<=0;)i.pop();i.push(this.body[s])}i.pop(),e.pop(),this.body=e.concat(i),this.update()}area(){return this.body.length>3?this.body.concat(this.body[0].copy()).part(2,1).map(t=>t[0].cross(t[1])/2).sum():0}massCenter(){if(this.body.length>2){var t=this.body.concat(this.body[0].copy());let e=t.part(2,1).map(t=>(t[0].x+t[1].x)*t[0].cross(t[1])/6).sum(),s=t.part(2,1).map(t=>(t[0].y+t[1].y)*t[0].cross(t[1])/6).sum(),i=this.area();return new g.a(e/i,s/i)}console.error("massCenter needs at least two points over the curve")}includes(t){var e=this.body.concat(this.body[0].copy());const s=(t,e,s)=>e.sub(t).cross(s.sub(t)),i=s(t,e[0],e[1]);for(let r=1;r<e.length-1;r++)if(i*s(t,e[r],e[r+1])<=0)return!1;return!0}at(t){for(var e=t*this.length(),s=0,i=null,r=null,o=0,n=0;n<this.body.length-1&&(i=this.body[n],!(s+(o=(r=this.body[n+1].sub(i)).mag())>=e));n++)s+=o;let a=(e-s)/o;return i.add(r.mult(a))}insertAt(t,e){for(var s=t*this.length(),i=0,r=null,o=null,n=0,a=0;a<this.body.length-1&&(r=this.body[a],!(i+(n=(o=this.body[a+1].sub(r)).mag())>=s));a++)i+=n;let h=(s-i)/n,l=r.add(o.mult(h));return void 0!==e&&l.setAttr(e),this.body.splice(a+1,0,l),l}draw(t,e,s){let i=this.body.filter(t=>t.attr.original);for(var r=0;r<i.length;)i.length-r>3?(t.bezierCurveToVec(i.slice(r+1,r+4),s),r+=4):(t.lineToVec(i[r],s),r+=1)}}class C extends m.a{constructor(t){super(t),this.type="Stroke",this.body=t.body.map(t=>new x(t)),this.update()}rotate(t){for(let e of this.body)e.rotate(t);this.update()}curl(t){1==this.body.length&&this.body[0].curl(t)}at(t){return this.body[t.curve].at(t.r)}hide(t){1==t&&(this.hidden=!0)}insertAt(t,e){return this.body[t.curve].insertAt(t.r,e)}remove(t){for(let e of this.body)for(let s=0;s<e.body.length;)t(e.body[s])?e.body.splice(s,1):s+=1}duringUpdate(){if(this.body.length>1)for(let t=1;t<this.body.length;t++)if(this.body[t].body.length>1&&this.body[t-1].body.length){let e=this.body[t-1].body.last(),s=this.body[t],i=s.body[0];s.trans(e.sub(i)),e.setAttr({joint:!0}),i.setAttr({joint:!0})}}draw(t,e,s){if(!this.hidden){t.beginPath(),t.moveToVec(this.body[0].body[0],s);for(let i of this.body)i.draw(t,e,s);t.stroke()}}}class w extends m.a{constructor(t){super(t),this.type="Radical",this.body=t.body.map(t=>new C(t))}at(t){this.body[t.stroke].at(t)}cross(t){var e=this.body[t.dest.ith].at(t.dest),s=this.body[t.self.ith].at(t.self);this.body[t.self.ith].trans(e.sub(s))}core(t){let e=t.map(t=>this.body[t.ith].insertAt(t,{corebound:!0}));this.corebound=new x(e),this.corebound.convexHull(),e=this.body.map(t=>t.flatten()).map(t=>{let e=t=>t.attr.corebound,s=t.findIndex(e),i=t.reverse(),r=t.length-1-i.findIndex(e);return t.reverse(),[t.slice(0,s+1),t.slice(s,r+1),t.slice(r)]});let s=[].concat(...e.map(t=>[t[0],t[2].reverse()])).map(t=>new x(t.reverse())).filter(t=>t.length()>.01);this.outliers={l:[],r:[],t:[],b:[]};for(let t of s)if(t.body.length>=2){let e=t.body[0],s=t.body[1].sub(e).angle();45>s&&s>=-45&&this.outliers.r.push(t),135>s&&s>=45&&this.outliers.b.push(t),(s>=135||s<-135)&&this.outliers.l.push(t),-45>s&&s>=-135&&this.outliers.t.push(t)}this.massCenter=this.corebound.massCenter(),this.outline=new x(this.flatten()),this.outline.convexHull(),this.geomCenter=this.outline.massCenter()}draw(t,e,s){t.lineWidth=e,t.lineCap="square",t.lineJoin="miter",t.miterLimit=3,t.strokeStyle="black";for(let i of this.body)i.draw(t,e,s);if(this.outline){t.lineWidth=1,t.strokeStyle="black",t.moveToVec(this.outline.body[0],s);for(let e of this.outline.body)t.lineToVec(e,s);t.closePath(),t.stroke()}if(this.outliers){let e={r:["red","右"],l:["green","左"],t:["blue","上"],b:["yellow","下"]};for(let i in this.outliers){t.strokeStyle="black",t.fillStyle="white",t.font="bold 20px Helvetica";for(let r of this.outliers[i]){t.circle(r.body[0].mult(s),5,!0);for(let o of r.body)t.fillText(e[i][1],o.x*s-10,o.y*s+10),t.strokeText(e[i][1],o.x*s-10,o.y*s+10)}}}if(this.corebound){t.fillStyle="rgb(128, 64, 0, 0.5)",t.beginPath(),t.moveToVec(this.corebound.body[0],s);for(let e of this.corebound.body)t.lineToVec(e,s);t.fill()}if(this.massCenter){t.strokeStyle="black",t.fillStyle="black";let e=this.box.center();t.circle(this.massCenter.mult(s),5,!0),t.circle(e.mult(s),5,!0),console.log(e,this.massCenter)}}}class S extends m.a{constructor(t){if(super(t),this.body=[],t&&t.body)for(let e of t.body){let t=e;"Stroke"===t.type&&(t={type:"Radical",body:[t],vars:{},prog:[]}),"Radical"===t.type&&this.body.push(new w(t)),"Char"===t.type&&this.body.push(new S(t))}this.type="Char",this.modify()}cross(t){var e=this.body[t.dest.ith].at(t.dest),s=this.body[t.self.ith].at(t.self);this.body[t.self.ith].trans(e.sub(s))}place(t){var e=this.body[t.self.ith],s=this.body[t.dest.ith],i=e.corebound.area(),r=s.corebound.area();console.log(i,r,"area");var o=s.massCenter;switch(t.pos){case 0:e.stretch(new g.a(.65,1)),s.stretch(new g.a(.65,1));for(let t in e.outliers)for(let s of e.outliers[t])"r"==t&&s.scale(1.2),"l"==t&&s.scale(1/1.2/1.2);for(let t in s.outliers)for(let e of s.outliers[t])"l"==t&&e.scale(1.2),"r"==t&&e.scale(1/1.2/1.2);o.x+=e.corebound.box.size().add(s.corebound.box.size()).mult(.5).x-2.5,o=o.sub(e.massCenter);break;case 1:e.stretch(new g.a(1,.65)),s.stretch(new g.a(1,.65)),o.y+=e.box.size().add(s.box.size()).mult(.5).y,o=o.sub(e.massCenter)}this.body[t.self.ith].trans(o)}postUpdate(){if(!this.body.some(t=>void 0===t.corebound)){let t=[].concat(...this.body.map(t=>t.corebound.body));this.corebound=new x(t),this.corebound.convexHull(),this.massCenter=this.corebound.massCenter();let e=[].concat(...this.body.map(t=>t.outline.body));this.outline=new x(e),this.outline.convexHull(),this.geomCenter=this.outline.massCenter()}}draw(t,e,s){if(this.corebound&&this.corebound.body.length>0){t.fillStyle="rgb(128, 64, 0, 0.3)",t.beginPath(),t.moveToVec(this.corebound.body[0],s);for(let e of this.corebound.body)t.lineToVec(e,s);t.fill()}this.massCenter&&(t.strokeStyle="black",t.circle(this.massCenter.mult(s),5,!0));for(let i of this.body)i.draw(t,e,s)}}CanvasRenderingContext2D.prototype.moveToVec=function(t,e){this.moveTo(t.x*e,t.y*e)},CanvasRenderingContext2D.prototype.circle=function(t,e,s,i){this.beginPath(),this.arc(t.x*s,t.y*s,e,0,2*Math.PI),i?this.fill():this.stroke()},CanvasRenderingContext2D.prototype.lineToVec=function(t,e){this.lineTo(t.x*e,t.y*e)},CanvasRenderingContext2D.prototype.bezierCurveToVec=function(t,e){3==t.length&&this.bezierCurveTo(t[0].x*e,t[0].y*e,t[1].x*e,t[1].y*e,t[2].x*e,t[2].y*e)};(new class{constructor(){this.base={},this.input=new c(this),this.currCharName="",this.currSpec={},this.preview=document.getElementById("preview").getContext("2d"),this.shouldShowStrokes=!1,document.getElementById("create").onclick=function(t){this.create()}.bind(this),document.getElementById("show-stroke").onclick=function(t){this.shouldShowStrokes=!this.shouldShowStrokes,this.updateCharList(this.base)}.bind(this),document.getElementById("var-bars").style.display="none",document.getElementById("toggle-code-param").onclick=function(t){let e=document.getElementById("code-list"),s=document.getElementById("var-bars");e.style.display="none"==e.style.display?"flex":"none",s.style.display="none"==s.style.display?"block":"none"}}initStroke(t){this.getStrokeSpec(t),this.initVariableControls(),this.char=new S(this.currSpec),this.updateWithPoint()}updateStroke(){this.char=new S(this.currSpec),this.updateWithPoint()}updateBase(){new Promise(function(t,e){var s=new XMLHttpRequest;s.open("GET","data/stroke-spec.json",!0),s.onload=function(){this.status>=200&&this.status<300?t(s.response):e({status:this.status,statusText:s.statusText})},s.onerror=function(){e({status:this.status,statusText:s.statusText})},s.send()}).then(function(t){this.base=JSON.parse(t),this.updateCharList(this.base)}.bind(this))}updateCharList(t){for(var e=document.getElementById("char-list");e.firstChild;)e.removeChild(e.firstChild);for(let i in t)if(this.shouldShowStrokes||"Radical"===this.base[i].type||"Char"===this.base[i].type){var s=document.createElement("button");s.appendChild(document.createTextNode(i)),s.classList.add("char-button"),s.onclick=function(t){console.clear(),this.currCharName=i,this.initStroke(i),this.input.update(this.getStrokeSpecText(i))}.bind(this),e.appendChild(s)}}submit(){var t=document.getElementById("stroke-list").value,e=JSON.parse(function(t){var e=t.split("\n").filter(t=>!t.match(/^\s*$/)),s="",i=[],r=0;for(let t=0;t<e.length;t++){for(var o=e[t].search(/\S|$/);i.length>0&&i[i.length-1].indent>=o;)s+=d(i),i.pop();r=0;for(var n=e[t];n.length>0;)switch(n[0]){case" ":i[i.length-1].comma?s+=", ":i[i.length-1].comma=!0,r+=n.search(/\S|$/),n=n.trim();break;case"@":s+="[",i.push({type:"[",indent:r,comma:!1}),r+=1,n=n.slice(1);break;case"#":s+="{",i.push({type:"{",indent:r,comma:!1}),r+=1,n=n.slice(1);break;case":":s+=":",i.push({type:":",indent:r}),r+=1,n=n.slice(1);break;case'"':var a=n.match(/"(?:\\"|[^"])*"/);if(!a)throw"Quoted string missing at Line: "+t;i.length>0&&":"==i[i.length-1].type&&i.pop(),r+=a[0].length,s+=n.slice(0,a[0].length),n=n.slice(a[0].length);break;default:var h=n.match(/[^\s:]*/);if(!h)throw"Simple string got some problem at Line: 1";i.length>0&&":"==i[i.length-1].type&&i.pop(),r+=h[0].length;var l=n.slice(0,h[0].length),u=parseFloat(l);s+=u||0==u?u:'"'+l+'"',n=n.slice(h[0].length)}}for(;i.length>0&&i[i.length-1].indent>=0;)s+=d(i),i.pop();return s}(t));this.base[this.currCharName]=e,this.initStroke(this.currCharName)}save(){var t,e=JSON.stringify(this.base,null,2),s=this.currCharName;(t=e,new Promise(function(e,s){var i=new XMLHttpRequest;i.open("POST","save",!0),i.setRequestHeader("content-type","application/json"),i.onload=function(){this.status>=200&&this.status<300?e(i.response):s({status:this.status,statusText:i.statusText})},i.onerror=function(){s({status:this.status,statusText:i.statusText})},i.send(t)})).then(function(t){document.getElementById("indicator").innerText="『"+s+"』字编辑已然保存"}).catch(function(t){console.log("error",t)})}create(){var t=document.getElementById("new-char-name").value;void 0!==this.base[t]?document.getElementById("indicator").innerText="『"+t+"』字已然存在了":(this.base[t]={type:"Radical",body:[],vars:{},prog:[]},"~"==t[0]&&(this.base[t].unnamed="true"),this.currCharName=t,this.currSpec=this.base[t],this.updateCharList(this.base))}suggest(){this.submit(),this.getStrokeSpec(this.currCharName),this.base[this.currCharName]=suggestSpec(this.base[this.currCharName],this.currSpec),this.base[this.currCharName].text=l(this.base[this.currCharName]),this.input.update(this.base[this.currCharName].text),this.initStroke(this.currCharName)}replaceVars(){delete this.base[this.currCharName].text,console.log(this.base[this.currCharName]),this.base[this.currCharName]=replaceVariables(this.base[this.currCharName]),this.base[this.currCharName].text=l(this.base[this.currCharName]),this.input.update(this.base[this.currCharName].text),this.initStroke(this.currCharName)}getStrokeSpec(t){var e=this.base[t].type;document.getElementById("indicator").innerText="载入"+{Char:"全字",Radical:"部首",Compound:"笔画",Curve:"简单笔画"}[e]+"『"+t+"』",this.currSpec=function(t,e){var s=e[t];if(console.log(e),"Stroke"==s.type&&(s={type:"Radical",vars:{},body:[y(t,e)]}),"Radical"==s.type){s={type:"Char",vars:{},body:[y(t,e)]};for(let t of s.body)for(let e in t.vars)s.vars[e]=t.vars[e]}else"Char"==s.type&&(console.log("getSpec",s.type),s=y(t,e));return s}(t,this.base),console.log("currSpec",this.currSpec)}getStrokeSpecText(t){return this.base[t].text&&delete this.base[t].text,l(this.base[t])}initVariableControls(){let t=document.getElementById("var-bars");for(;t.firstChild;)t.removeChild(t.firstChild);let e=document.createElement("div");if(e.appendChild(b("笔画宽度")),this.strokeWidth=25,e.appendChild(p(name,{val:25,range:{min:10,max:50}},function(t){console.clear(),this.strokeWidth=parseFloat(t.target.value),this.updateStroke()}.bind(this))),t.appendChild(e),this.currSpec.vars)for(let e in this.currSpec.vars)t.appendChild(f(e,this.currSpec.vars[e],function(t){null!=this.currSpec.vars[e].val&&(this.currSpec.vars[e].val=parseFloat(t.target.value),document.getElementById(t.target.name+"-indicator").innerText=this.currSpec.vars[e].val),this.base[this.currCharName].vars=this.currSpec.vars,this.input.update(l(this.base[this.currCharName])),this.updateStroke()}.bind(this)))}updateWithPoint(){let t,e=this.preview.canvas.width,s=this.preview.canvas.height;this.preview.clearRect(0,0,e,s),function(t,e,s,i){void 0===i&&(i={lineWidth:1,strokeStyle:"rgb(0, 0, 0, 0.2)"}),Object.assign(t,i),t.beginPath(),t.rect(.05*e,.05*s,.9*e,.9*s);for(let i=2;i<5;i++)t.moveTo(0,i*e/6),t.lineTo(s,i*e/6),t.moveTo(i*s/6,0),t.lineTo(i*s/6,e);t.stroke()}(this.preview,e,s),t=this.char.massCenter?this.char.massCenter.add(this.char.geomCenter).mult(.5):this.char.box.center(),this.preview.translate(e/2-45*t.x,s/2-45*t.y),this.char.draw(this.preview,this.strokeWidth,45),this.preview.setTransform(1,0,0,1,0,0)}}).updateBase()}]);