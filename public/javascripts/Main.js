!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{constructor(t,e){void 0===e?void 0===t?(this.x=0,this.y=0):void 0!==t.x&&void 0!==t.y?(this.x=t.x,this.y=t.y):"number"==typeof t&&(this.x=Math.cos(t*Math.PI/180),this.y=Math.sin(t*Math.PI/180)):(this.x=t,this.y=e)}add(t){return new i(this.x+t.x,this.y+t.y)}sub(t){return new i(this.x-t.x,this.y-t.y)}mult(t){return void 0===t.x?new i(this.x*t,this.y*t):new i(this.x*t.x,this.y*t.y)}head(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))}isHeaderTo(t){return this.x<t.x&&this.y<t.y}tail(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))}isTailerTo(t){return this.x>t.x&&this.y>t.y}copy(){return new i(this.x,this.y)}mag(){return Math.hypot(this.x,this.y)}draw(t,e,s){void 0===s&&(s="rgb(0, 0, 0, 0.5)"),void 0===e&&(e=10),t.fillStyle=s,t.beginPath(),t.arc(this.x,this.y,e,0,2*Math.PI),t.fill()}}class a{constructor(t,e){void 0===e&&(e=new i),void 0===t&&(t=new i),this.head=t.copy(),this.tail=e.copy()}union(t){var e=this.head.head(t.head),s=this.tail.tail(t.tail);return new a(e,s)}copy(){return new a(this.head.copy(),this.tail.copy())}center(){return this.head.add(this.tail).mult(new i(.5,.5))}size(){return this.tail.sub(this.head)}include(t){return t.isTailerTo(this.head)&&t.isHeaderTo(this.tail)}moveWithHead(t){var e=this.size();return new a(t,t.add(e))}draw(t){var e=this.size();t.lineWidth=3,t.beginPath(),t.rect(this.head.x,this.head.y,e.x,e.y),t.stroke()}}class n{constructor(t,e){this.body=void 0===e||void 0===e.body?[]:e.body.map(e=>new t(e)),this.head=void 0===e||void 0===e.head?new i:e.head,this.progs=void 0===e||void 0===e.progs?[]:e.progs,this.box=new a}rotate(t){this.body.forEach(e=>e.rotate(t)),this.update()}scale(t){this.body.forEach(e=>e.scale(t)),this.update()}trans(t){this.head=this.head.add(t),this.update()}modify(t){void 0===t&&(t=this.progs);for(let t of this.body)t.modify();for(let e of t)for(let t in e)"ith"!=t&&"progs"!=t&&(void 0===e.ith?this[t](e[t]):this.body[e.ith][t](e[t]));this.update()}update(){if(this.body.length>0&&(this.body[0].head=this.head.copy(),this.body[0].update(),this.box=this.body[0].box,this.tail=this.body[0].tail),this.body.length>1)for(let t=1;t<this.body.length;t++)try{this.body[t].head=this.body[t-1].tail.copy(),this.body[t].update(),this.tail=this.body[t].tail,this.box=this.box.union(this.body[t].box)}catch(t){}}translate(t){this.head=this.head.add(t)}copy(){var t=new this.constructor;return t.body=this.body.map(t=>t.copy()),t.head=this.head.copy(),t}draw(t){for(let e of this.body)e.draw(t)}sample(t){return this.body.reduce(function(e,s){return e.concat(s.sample(t))},[])}}function r(t){return t.reduce((t,e)=>t.concat(Array.isArray(e)?r(e):e),[])}function o(t,e){var s=1e4,i=-1e4,a=0,n=0,r=t.map(e);for(let t in r)r[t]>i?(i=r[t],n=t):r[t]<s&&(s=r[t],a=t);return{max:parseInt(n),min:parseInt(a)}}class h extends n{constructor(t){super(),this.len=t.len,this.ang=t.ang,this.head=new i,this.tail=new i,this.box=new a,this.update()}copy(){return new h({len:this.len,ang:this.ang,head:this.head})}draw(t){t.lineTo(this.tail.x,this.tail.y)}rotate(t){this.ang+=t,this.update()}trans(t){this.head=this.head.add(new i(t)),this.update()}scale(t){this.len*=t,this.update()}modify(t){void 0===t&&(t=this.progs);for(let e of t)switch(Object.keys(e)[0]){case"trans":this.trans(e.trans);break;case"rotate":this.rotate(e.rotate);break;case"stretch":this.stretch(e.scale)}this.update()}update(){var t=new i(this.ang);this.tail=this.head.add(t.mult(this.len));var e=this.head.head(this.tail),s=this.tail.tail(this.head);this.box=new a(e,s)}sample(t){for(var e=[],s=new i(this.ang),a=0;a<this.len;a+=t)e.push(s.mult(a).add(this.head));return e}}class d extends n{constructor(t){super(h,t),this.update()}at(t){var e,s=this.head.copy(),a=t*this.body.reduce((t,e)=>t+e.len,0),n=0;for(let t=0;t<this.body.length-1&&(e=this.body[t],n+=this.body[t].len,s=s.add(new i(e.ang).mult(e.len)),!(this.body[t+1].len+n>a));t++);return s=s.add(new i(e.ang).mult(a-n))}}class u extends n{constructor(t){super(d,t),this.update()}at(t){return this.body[t.curve].at(t.r)}sample(t){return this.body.map(function(e){return e.sample(t)})}}class l extends n{constructor(t){console.log("strokeset constructor",t),super(u,t),this.update()}cross(t){var e=this.body[t.dest.ith].at(t.dest),s=this.body[t.self.ith].at(t.self);this.body[t.self.ith].trans(e.sub(s))}update(){if(this.body.length>0&&(this.body[0].update(),this.box=this.body[0].box),this.body.length>1)for(let t=1;t<this.body.length;t++)try{this.body[t].update(),this.box=this.box.union(this.body[t].box)}catch(t){console.error("StrokeSet update",this.box)}}stretchFull(t){var e,s=this.box.size(),i=t.canvas.width,a=t.canvas.height;e=Math.min(s.x,s.y)>Math.max(i,a)?Math.max(i/s.x,a/s.y):Math.min(i/s.x,a/s.y);for(let t of this.body)t.head=t.head.mult(e);this.scale(.9*e),this.update()}transCenter(){for(let t of this.body)t.head=t.head.add(new i(300,300).sub(this.box.center()));this.update()}draw(t){this.stretchFull(t),this.transCenter(),t.lineWidth=25,t.lineCap="round",t.lineJoin="round",t.strokeStyle="rgb(0, 0, 0, 0.5)";for(let e of this.body)e.head.draw(t),t.beginPath(),t.moveTo(e.head.x,e.head.y),e.draw(t),t.stroke()}sample(t){this.samples=this.body.reduce(function(e,s){return e.concat(s.sample(t))},[])}}function c(t,e){var s=new l(e);s.modify(),console.log(s),t.lineWidth=1,s.draw(t),s.sample(20);for(let e of s.samples)for(let s of e)s.draw(t,5);!function(t,e,s){var n,h,d=r(e),u=t.canvas.width,l=t.canvas.height,c=0,y=new a;for(let t=20*s;t<=l;t+=s)for(let e=s;e<=t;e+=s){var p=[];for(let n=0;n+e<=u;n+=s)for(let r=0;r+t<=l;r+=s){var f=new a(new i(n,r),new i(n+e,r+t));p.push({p:d.filter(t=>f.include(t)).length,b:f.copy()})}var b=o(p,t=>t.p),x=0!=p.length?p[b.max].p-p[b.min].p:0;x>c&&(c=x,y=p[b.max].b.copy(),n=p.map(t=>t.p),h=n.reduce((t,e)=>t+e)/n.length,n.map(t=>Math.abs(t-h)).reduce((t,e)=>t+e),n.length)}y.draw(t),d.filter(t=>y.include(t)).forEach(e=>e.draw(t,7,"rgb(192, 0, 0, 1)"))}(t,s.samples,20),function(t,e,s){t.lineWidth=1;for(let i in e)for(let n in e)if(i<n)for(let r of e[i])for(let i of e[n])if(r.sub(i).mag()<s){var a=r.sub(i).mag()/s;t.strokeStyle="rgb(0, 0, 0, "+.2*a+")",t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(i.x,i.y),t.stroke()}var n=r(e),o=new i;for(let t of n)o=o.add(t);(o=o.mult(1/n.length)).draw(t,10,"red")}(t,s.samples,150)}function y(t,e){var s=function(t){return JSON.parse(JSON.stringify(t))}(t[e]);switch(s.type){case"radical":return s.body=s.body.reduce(function(e,s){var i=y(t,s);return"radical"==i.type?e.concat(i.body):e.concat(i)},[]),s;case"compound":return s.body=s.body.reduce(function(e,s){var i=y(t,s);return"compound"==i.type?e.concat(i.body):e.concat(i)},[]),s;case"simple":return{type:"compound",body:[s]}}}function p(t,e,s){var i=function(t){return{start:t.selectionStart,end:t.selectionEnd}}(t),a=t.value;t.value=a.slice(0,i.start)+e+a.slice(i.start),function(t,e){setTimeout(function(){t.selectionStart=e,t.selectionEnd=e},1)}(t,i.start+s)}var f=document.getElementById("canvas"),b=document.getElementById("canvas").getContext("2d"),x=window.devicePixelRatio;f.style.width=f.width+"px",f.style.height=f.height+"px",f.width=f.width*x,f.height=f.height*x,b.scale(x,x),function(t){t.addEventListener("keypress",function(e){"Enter"===e.key&&e.ctrlKey?redrawRadical():function(t,e){var s={"[":["[]",1],"'":['""',1],'"':['""',1],"{":["{}",1],Enter:["\n\n",1]};e.key in s&&(e.preventDefault(),p(t,s[e.key][0],s[e.key][1]))}(t,e)}),t.focus()}(document.getElementById("stroke-list")),new Promise(function(t,e){var s=new XMLHttpRequest;s.open("GET","data/stroke-spec.json",!0),s.onload=function(){this.status>=200&&this.status<300?t(s.response):e({status:this.status,statusText:s.statusText})},s.onerror=function(){e({status:this.status,statusText:s.statusText})},s.send()}).then(function(t){var e=y(JSON.parse(t),"å¥³");c(b,e)})}]);