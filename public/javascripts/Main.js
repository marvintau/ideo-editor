!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){"use strict";s.d(e,"a",function(){return i});class i{constructor(t,e){void 0===e?void 0===t?(this.x=0,this.y=0):void 0!==t.x&&void 0!==t.y?(this.x=t.x,this.y=t.y):"number"==typeof t&&(this.x=Math.cos(t*Math.PI/180),this.y=Math.sin(t*Math.PI/180)):(this.x=t,this.y=e)}add(t){return new i(this.x+t.x,this.y+t.y)}sub(t){return new i(this.x-t.x,this.y-t.y)}mult(t){return void 0===t.x?new i(this.x*t,this.y*t):new i(this.x*t.x,this.y*t.y)}cross(t){return this.x*t.y-t.x*this.y}head(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))}isHeaderTo(t){return this.x<t.x&&this.y<t.y}tail(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))}isTailerTo(t){return this.x>t.x&&this.y>t.y}copy(){return new i(this.x,this.y)}mag(){return Math.hypot(this.x,this.y)}sampleTo(t,e){var s=[],i=t.sub(this);for(let t=0;t<e;t++)s.push(this.add(i.mult(t/e)));return s}}},function(t,e,s){"use strict";s.r(e);var i=s(0),n=s(2),r=s(3);class a extends n.a{constructor(t){super(),this.len=t.len,this.ang=t.ang,this.head=new i.a,this.tail=new i.a,this.box=new r.a,this.update()}copy(){return new a({len:this.len,ang:this.ang,head:this.head})}rotate(t){this.ang+=t,this.update()}trans(t){this.head=this.head.add(new i.a(t)),this.update()}scale(t){this.len*=t,this.update()}modify(t){t=void 0===t?this.prog:this.prog.concat(t);for(let e of t)switch(Object.keys(e)[0]){case"trans":this.trans(e.trans);break;case"rotate":this.rotate(e.rotate);break;case"stretch":this.stretch(e.scale)}this.update()}update(){var t=new i.a(this.ang);this.tail=this.head.add(t.mult(this.len));var e=this.head.head(this.tail),s=this.tail.tail(this.head);this.box=new r.a(e,s)}}class o extends n.a{constructor(t){super(a,t),this.update()}at(t){for(var e=t*this.body.reduce((t,e)=>t+e.len,0),s=0,i=null,n=0;n<this.body.length&&!(s+(i=this.body[n]).len>=e);n++)s+=this.body[n].len;var r=(e-s)/i.len,a=i.tail.sub(i.head).mult(r);return i.head.add(a)}}class h extends n.a{constructor(t){super(o,t),this.update()}at(t){return this.body[t.curve].at(t.r)}toPointList(){var t=[];for(let e=0;e<this.body.length;e++){let s=this.body[e].body,i=[s[0].head];for(let t=0;t<s.length;t++)i.push(s[t].tail);t.push(i)}return t}}function u(t,e,s,i){var n=t.sub(s).cross(s.sub(i)),r=-t.sub(e).cross(t.sub(s)),a=t.sub(e).cross(s.sub(i)),o=n/a,h=r/a;return{p:t.add(e.sub(t).mult(o)),s:o,t:h}}class l extends n.a{constructor(t){super(h,t),this.modify()}cross(t){var e=this.body[t.dest.ith].at(t.dest),s=this.body[t.self.ith].at(t.self);this.body[t.self.ith].trans(e.sub(s))}update(){if(this.body.length>0&&(this.body[0].update(),this.box=this.body[0].box),this.body.length>1)for(let t=1;t<this.body.length;t++)this.body[t].update(),this.box=this.box.union(this.body[t].box)}stretchFull(t,e){var s,i=this.box.size(),n=t.width*e,r=t.height*e;s=Math.min(i.x,i.y)>Math.max(n,r)?Math.max(n/i.x,r/i.y):Math.min(n/i.x,r/i.y);for(let t of this.body)t.head=t.head.mult(s);this.scale(s),this.update()}transCenter(){for(let t of this.body)t.head=t.head.add((new i.a).sub(this.box.center()));this.update()}toPointList(t,e){this.stretchFull(t,e),this.transCenter();var s=[];for(let t of this.body)s=s.concat(t.toPointList());return s=function(t){for(let s=0;s<t.length;s++)for(let i=0;i<s;i++)for(let n=0;n<t[s].length-1;n++)for(let r=0;r<t[i].length-1;r++){var e=u(t[s][n],t[s][n+1],t[i][r],t[i][r+1]);e.p.intersect=!0,e.s<1&&e.s>0&&e.t>0&&e.t<1&&(t[s].splice(1+n++,0,e.p),t[i].splice(1+r++,0,e.p))}for(let e=0;e<t.length;e++){var s=[[]];for(let i=0;i<t[e].length;i++)s[s.length-1].push(t[e][i]),t[e][i].intersect&&s.push([t[e][i]]);t[e]=s}return t}(s)}}var c=80;function d(t){return t.match(/[ @]/)?'"'+t+'"':t}function p(t,e){return(0==e?"@ ":"  ")+t}function f(t,e){return(0==e?"# ":"  ")+t}function y(t,e,s){var i=Object.keys(t),n=i.map(i=>({key:i,val:e(t[i],s-i.length)})),r=n.map(t=>t.val.some(t=>t.includes("@")||t.includes("#"))).some(t=>t),a=n.map(t=>d(t.key)+": "+t.val[0]).join(" "),o=r||a.length>s,h=n.map(t=>t.val.map((e,s)=>(function(t,e,s){var i=d(s);return(0==e?i+": ":" ".repeat(i.length+2))+t})(e,s,t.key))).flatten(),u=h.some(t=>t.length>c),l=i.map(i=>({key:i,val:e(t[i],s-2)})).map(t=>(function(t,e){return[e+":"].concat(t.map(t=>" "+t))})(t.val,t.key)).flatten();return u?l.map(f):o?h.map(f):["# "+a]}function b(t,e){switch(typeof t){case"string":return[d(t)];case"number":return[t.toString()];case"object":return Array.isArray(t)?function(t,e,s){var i=t.map(t=>e(t,s-2)).flatten(),n=i.join(" ");return i.some(t=>t.includes("@")||t.includes("#"))||n.length>s?i.map(p):["@ "+n]}(t,b,e):y(t,b,e)}}function m(t){return{"{":"}","[":"]",":":""}[t[t.length-1].type]}function g(t){return t.split("\n").map(t=>t.replace(/(\S+\s*)(?=:)/g,'<span class="key">$1</span>').replace(/([#@:])/g,'<span class="keyword">$1</span>')).join("\n")}Array.prototype.flatten=function(){return[].concat(...this)},Array.prototype.last=function(){return this[this.length-1]};class v{constructor(t){this.input=document.getElementById("stroke-list"),this.strokeBase=t,this.init()}init(){var t=this;window.addEventListener("keyup",function(e){"Enter"===e.key&&e.ctrlKey&&e.shiftKey?(t.strokeBase.submit(t.input.value),t.strokeBase.save()):"Enter"===e.key&&e.ctrlKey?t.strokeBase.submit(t.input.value):t.highlight()})}highlight(){this.input.style.height=this.input.scrollHeight;var t=this.input.value;document.getElementById("code-display").innerHTML=g(t)}update(t){this.input.value=t,this.highlight()}}function x(t,e){let s=function(t){return JSON.parse(JSON.stringify(t))}(e[t]);switch(s.type){case"radical":return s.body=s.body.reduce(function(t,s){let i=x(s,e);return"radical"==i.type?t.concat(i.body):t.concat(i)},[]),s;case"compound":return s.body=s.body.reduce(function(t,s){let i=x(s,e);return"compound"==i.type?t.concat(i.body):t.concat(i)},[]),s;case"simple":return{type:"compound",body:[s]}}}function _(t,e,s){var i=document.createElement("div");return i.appendChild(function(t){var e=document.createElement("label");return e.innerHTML=t,e.setAttribute("for",t),e}(t)),i.appendChild(function(t,e,s){var i=document.createElement("INPUT");return i.setAttribute("type","range"),i.classList.add("slider"),i.setAttribute("name",t),i.setAttribute("min",e.range.min),i.setAttribute("max",e.range.max),i.setAttribute("value",e.val),i.setAttribute("step",.01),i.addEventListener("input",s),i.addEventListener("change",s),i}(t,e,s)),i}class w{constructor(){this.base={},this.input=new v(this),this.currCharName="",this.currSpec={}}updateBase(){new Promise(function(t,e){var s=new XMLHttpRequest;s.open("GET","data/stroke-spec.json",!0),s.onload=function(){this.status>=200&&this.status<300?t(s.response):e({status:this.status,statusText:s.statusText})},s.onerror=function(){e({status:this.status,statusText:s.statusText})},s.send()}).then(function(t){this.base=JSON.parse(t),this.updateUI(this.base)}.bind(this))}updateUI(t){var e=document.getElementById("char-list");for(let i in t)if("radical"==t[i].type){var s=document.createElement("button");s.appendChild(document.createTextNode(i)),s.classList.add("char-button"),s.onclick=function(t){this.currCharName=i,this.initStroke(i),this.input.update(this.getStrokeSpecText(i))}.bind(this),e.appendChild(s)}}submit(){var t=document.getElementById("stroke-list").value,e=JSON.parse(function(t){var e=t.split("\n").filter(t=>!t.match(/^\s*$/)),s="",i=[],n=0;for(let t=0;t<e.length;t++){for(var r=e[t].search(/\S|$/);i.length>0&&i[i.length-1].indent>=r;)s+=m(i),i.pop();n=0;for(var a=e[t];a.length>0;)switch(a[0]){case" ":i[i.length-1].comma?s+=", ":i[i.length-1].comma=!0,n+=a.search(/\S|$/),a=a.trim();break;case"@":s+="[",i.push({type:"[",indent:n,comma:!1}),n+=1,a=a.slice(1);break;case"#":s+="{",i.push({type:"{",indent:n,comma:!1}),n+=1,a=a.slice(1);break;case":":s+=":",i.push({type:":",indent:n}),n+=1,a=a.slice(1);break;case'"':var o=a.match(/"(?:\\"|[^"])*"/);if(!o)throw"Quoted string missing at Line: "+t;i.length>0&&":"==i[i.length-1].type&&i.pop(),n+=o[0].length,s+=a.slice(0,o[0].length),a=a.slice(o[0].length);break;default:var h=a.match(/[^\s:]*/);if(!h)throw"Simple string got some problem at Line: 1";i.length>0&&":"==i[i.length-1].type&&i.pop(),n+=h[0].length;var u=a.slice(0,h[0].length),l=parseFloat(u);s+=l||0==l?l:'"'+u+'"',a=a.slice(h[0].length)}}for(;i.length>0&&i[i.length-1].indent>=0;)s+=m(i),i.pop();return s}(t));this.base[this.currCharName]=e,this.base[this.currCharName].text=t}save(){(function(t){return new Promise(function(e,s){var i=new XMLHttpRequest;i.open("POST","save",!0),i.setRequestHeader("content-type","application/json"),i.onload=function(){this.status>=200&&this.status<300?e(i.response):s({status:this.status,statusText:i.statusText})},i.onerror=function(){s({status:this.status,statusText:i.statusText})},i.send(t)})})(JSON.stringify(this.base,null,2)).then(function(t){console.log("persisted")}).catch(function(t){console.log("error",t)})}getStrokeSpec(t){console.log(t),this.currSpec=x(t,this.base)}getStrokeSpecText(t){return void 0===this.base[t].text?function(t){return b(t,c).join("\n")}(this.base[t]):this.base[t].text}initVariableControls(){let t=document.getElementById("var-bars");for(;t.firstChild;)t.removeChild(t.firstChild);let e=this.currSpec.vars;for(let s in e)t.appendChild(_(s,e[s],function(t){e[s].val=parseFloat(t.target.value),this.updateStroke()}.bind(this)))}initStroke(t){}render(){}}function E(t){var e=new THREE.ConeBufferGeometry(250,200,60),s=new THREE.Mesh(e,t);return s.rotateOnAxis(new THREE.Vector3(1,0,0),Math.PI/2),s}function k(t,e){var s=[];for(let i=0;i<t;i++)s.push(E(e));return s}function S(t,e){var s=[];for(let n=0;n<t.length-1;n++){var i=t[n].sampleTo(t[n+1],e);s=s.concat(i)}return s.push(t[t.length-1]),s}function T(t,e){var s=[];for(let i=0;i<t.length;i++){s.push([]);for(let n=0;n<t[i].length;n++)s[s.length-1].push(S(t[i][n],e))}return s}function M(t,e,s,i){var n=T(t,e),r=function(t,e){var s=[];for(let i=0;i<t.length;i++)s.push(t[i].map((t,s)=>k(t.length,e[i][s])));return s}(n,i);for(let t=0;t<n.length;t++)for(let e=0;e<n[t].length;e++)for(let i=0;i<n[t][e].length;i++)s.add(r[t][e][i]);return r}class C{constructor(t,e){this.resolution=e,this.scene=t,this.mats=[],this.cones=[]}init(t){this.mats=[];for(let s=0;s<t.length;s++){this.mats.push([]);for(let i=0;i<t[s].length;i++){var e=new THREE.Color("rgb("+(255-20*i)+", "+(255-20*s)+", "+(255-20*s)+")");this.mats[s].push(new THREE.MeshBasicMaterial({color:e,side:THREE.BackSide}))}}this.cones=M(t,this.resolution,this.scene,this.mats)}update(t){!function(t,e,s){var i=T(t,s);for(let t=0;t<i.length;t++)for(let s=0;s<i[t].length;s++)for(let n=0;n<i[t][s].length;n++){let r=i[t][s][n];e[t][s][n].position.set(r.x,r.y,-100)}}(t,this.cones,this.resolution)}dispose(){for(let t=0;t<this.cones.length;t++)for(let e=0;e<this.cones[t].length;e++)for(let s=0;s<this.cones[t][e].length;s++)this.cones[t][e][s].geometry.dispose(),this.cones[t][e][s].material.dispose(),this.cones[t][e][s]=void 0;for(let t=0;t<this.mats.length;t++)for(let e=0;e<this.mats[t].length;e++)this.mats[t][e].dispose(),this.mats[t][e]=void 0}}class O{constructor(t){this.scene=t,this.mat=new THREE.LineBasicMaterial({color:0}),this.lines=[]}init(t){this.lines=function(t,e,s){var i=[];for(let r=0;r<t.length;r++){i.push([]);for(let a=0;a<t[r].length;a++){var n=new THREE.Line(new THREE.Geometry,s);i[r].push(n),e.add(n)}}return i}(t,this.scene,this.mat)}update(t){!function(t,e){for(let s=0;s<e.length;s++)for(let i=0;i<e[s].length;i++)t[s][i].geometry.vertices=e[s][i].map(t=>new THREE.Vector3(t.x,t.y,0)),t[s][i].geometry.verticesNeedUpdate=!0}(this.lines,t)}dispose(){!function(t){for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s].geometry.dispose(),t[e][s]=void 0}(this.lines),this.lines=[]}}(new class extends w{constructor(){super(),this.initView(),this.lines=new O(this.scene),this.voronoi=new C(this.scene,15)}initView(){this.renderer=new THREE.WebGLRenderer,this.camera=new THREE.OrthographicCamera(-235,235,-235,235,-235,235),this.scene=new THREE.Scene,this.renderer.setSize(470,470),document.getElementById("canvas-wrap").appendChild(this.renderer.domElement),this.size=this.renderer.getSize(),this.camera.lookAt(0,0,0)}clearScene(){for(;this.scene.children.length>0;)this.scene.remove(this.scene.children[0]);this.lines.dispose(),this.voronoi.dispose()}initStroke(t){this.getStrokeSpec(t),this.initVariableControls(),this.clearScene();let e=new l(this.currSpec).toPointList(this.size,.9);this.lines.init(e),this.voronoi.init(e,10),this.updateStroke()}updateStroke(){let t=new l(this.currSpec).toPointList(this.size,.9);this.lines.update(t),this.voronoi.update(t),this.renderer.render(this.scene,this.camera)}}).updateBase()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return CurveStructureBase});var _Vec_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_Box_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3);class CurveStructureBase{constructor(t,e){this.body=void 0===e||void 0===e.body?[]:e.body.map(e=>new t(e)),this.head=void 0===e||void 0===e.head?new _Vec_js__WEBPACK_IMPORTED_MODULE_0__.a:e.head,this.prog=void 0===e||void 0===e.prog?[]:e.prog,this.vars=void 0===e||void 0===e.vars?{}:e.vars,this.box=new _Box_js__WEBPACK_IMPORTED_MODULE_1__.a}rotate(t){this.body.forEach(e=>e.rotate(t)),this.update()}scale(t){this.body.forEach(e=>e.scale(t)),this.update()}trans(t){this.head=this.head.add(t),this.update()}len(){return this.body.reduce((t,e)=>t+e.len(),0)}getVariable(item){switch(typeof item){case"number":return item;case"string":switch(typeof this.vars[item].val){case"number":return this.vars[item].val;case"string":return eval(this.vars[item].val.replace(/@'(.*)'/,"this.getVariable('$1')"))}case"object":for(let t in item)item[t]=this.getVariable(item[t]);return item;default:console.error("Key not found",item,typeof item)}}modify(t,e){e=void 0===e?this.vars:Object.assign(this.vars,e),void 0===t&&(t=this.prog);for(let t of this.body)t.modify(void 0,e);for(let e of t)for(let t in e){var s=void 0===e.ith?this:this.body[e.ith];"prog"!=t?s[t](this.getVariable(e[t])):s.modify(e[t])}this.update()}ith(){}update(){if(this.body.length>0&&(this.body[0].head=this.head.copy(),this.body[0].update(),this.box=this.body[0].box,this.tail=this.body[0].tail),this.body.length>1)for(let t=1;t<this.body.length;t++)try{this.body[t].head=this.body[t-1].tail.copy(),this.body[t].update(),this.tail=this.body[t].tail,this.box=this.box.union(this.body[t].box)}catch(t){}}copy(){var t=new this.constructor;return t.body=this.body.map(t=>t.copy()),t.head=this.head.copy(),t}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(0);class n{constructor(t,e){void 0===e&&(e=new i.a),void 0===t&&(t=new i.a),this.head=t.copy(),this.tail=e.copy()}union(t){var e=this.head.head(t.head),s=this.tail.tail(t.tail);return new n(e,s)}copy(){return new n(this.head.copy(),this.tail.copy())}center(){return this.head.add(this.tail).mult(new i.a(.5,.5))}size(){return this.tail.sub(this.head)}include(t){return t.isTailerTo(this.head)&&t.isHeaderTo(this.tail)}moveWithHead(t){var e=this.size();return new n(t,t.add(e))}set(t,e,s,i){this.head.x=t,this.head.y=e,this.tail.x=t+s,this.tail.y=e+i}draw(t){var e=this.size();t.lineWidth=1,t.beginPath(),t.rect(this.head.x,this.head.y,e.x,e.y),t.stroke()}}}]);