!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s{constructor(t,e){void 0===e?void 0===t?(this.x=0,this.y=0):void 0!==t.x&&void 0!==t.y?(this.x=t.x,this.y=t.y):"number"==typeof t&&(this.x=Math.cos(t*Math.PI/180),this.y=Math.sin(t*Math.PI/180)):(this.x=t,this.y=e)}add(t){return new s(this.x+t.x,this.y+t.y)}sub(t){return new s(this.x-t.x,this.y-t.y)}mult(t){return void 0===t.x?new s(this.x*t,this.y*t):new s(this.x*t.x,this.y*t.y)}cross(t){return this.x*t.y-t.x*this.y}head(t){return new s(Math.min(this.x,t.x),Math.min(this.y,t.y))}isHeaderTo(t){return this.x<t.x&&this.y<t.y}tail(t){return new s(Math.max(this.x,t.x),Math.max(this.y,t.y))}isTailerTo(t){return this.x>t.x&&this.y>t.y}copy(){return new s(this.x,this.y)}mag(){return Math.hypot(this.x,this.y)}draw(t,e,i){void 0===i&&(i="rgb(255, 0, 0, 0.9)"),void 0===e&&(e=1),t.fillStyle=i,t.beginPath(),t.arc(this.x,this.y,e,0,2*Math.PI),t.fill()}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return CurveStructureBase});var _Vec_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_Box_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_Raster_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3);class CurveStructureBase{constructor(t,e){this.body=void 0===e||void 0===e.body?[]:e.body.map(e=>new t(e)),this.head=void 0===e||void 0===e.head?new _Vec_js__WEBPACK_IMPORTED_MODULE_0__.a:e.head,this.prog=void 0===e||void 0===e.prog?[]:e.prog,this.vars=void 0===e||void 0===e.vars?{}:e.vars,this.box=new _Box_js__WEBPACK_IMPORTED_MODULE_1__.a}rotate(t){this.body.forEach(e=>e.rotate(t)),this.update()}scale(t){this.body.forEach(e=>e.scale(t)),this.update()}trans(t){this.head=this.head.add(t),this.update()}len(){return this.body.reduce((t,e)=>t+e.len(),0)}getVariable(item){switch(typeof item){case"number":return item;case"string":switch(typeof this.vars[item].val){case"number":return this.vars[item].val;case"string":return eval(this.vars[item].val.replace(/@'(.*)'/,"this.getVariable('$1')"))}case"object":for(let t in item)item[t]=this.getVariable(item[t]);return item;default:console.error("Key not found",item,typeof item)}}modify(t,e){e=void 0===e?this.vars:Object.assign(this.vars,e),void 0===t&&(t=this.prog);for(let t of this.body)t.modify(void 0,e);for(let e of t)for(let t in e){var i=void 0===e.ith?this:this.body[e.ith];"prog"!=t?i[t](this.getVariable(e[t])):i.modify(e[t])}this.update()}ith(){}update(){if(this.body.length>0&&(this.body[0].head=this.head.copy(),this.body[0].update(),this.box=this.body[0].box,this.tail=this.body[0].tail),this.body.length>1)for(let t=1;t<this.body.length;t++)try{this.body[t].head=this.body[t-1].tail.copy(),this.body[t].update(),this.tail=this.body[t].tail,this.box=this.box.union(this.body[t].box)}catch(t){}}copy(){var t=new this.constructor;return t.body=this.body.map(t=>t.copy()),t.head=this.head.copy(),t}draw(t){for(let e of this.body)e.draw(t)}sample(t){return this.body.reduce(function(e,i){return e.concat(i.sample(t))},[])}rasterize(t){if(void 0===t){var e=document.getElementById("canvas").getContext("2d"),i=e.height,s=e.width;t=new _Raster_js__WEBPACK_IMPORTED_MODULE_2__.a(s,i)}for(let e of this.body)t=e.rasterize(t);return t}}},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s=i(0);class a{constructor(t,e){void 0===e&&(e=new s.a),void 0===t&&(t=new s.a),this.head=t.copy(),this.tail=e.copy()}union(t){var e=this.head.head(t.head),i=this.tail.tail(t.tail);return new a(e,i)}copy(){return new a(this.head.copy(),this.tail.copy())}center(){return this.head.add(this.tail).mult(new s.a(.5,.5))}size(){return this.tail.sub(this.head)}include(t){return t.isTailerTo(this.head)&&t.isHeaderTo(this.tail)}moveWithHead(t){var e=this.size();return new a(t,t.add(e))}set(t,e,i,s){this.head.x=t,this.head.y=e,this.tail.x=t+i,this.tail.y=e+s}draw(t){var e=this.size();t.lineWidth=1,t.beginPath(),t.rect(this.head.x,this.head.y,e.x,e.y),t.stroke()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(t*e)}setPixel(t,e){this.data[this.width*(e-1)+t]=1}countSlice(t,e,i,s){var a=0;for(let r=t;r<i;r++)for(let i=e;i<s;i++)a+=this.data[e*width+t];return a}}},function(t,e,i){"use strict";i.r(e);var s=80;function a(t){return t.match(/[ @]/)?'"'+t+'"':t}function r(t,e){return(0==e?"@ ":"  ")+t}function n(t,e){return(0==e?"# ":"  ")+t}function h(t,e,i){var r=Object.keys(t),h=r.map(s=>({key:s,val:e(t[s],i-s.length)})),o=h.map(t=>t.val.some(t=>t.includes("@")||t.includes("#"))).some(t=>t),d=h.map(t=>a(t.key)+": "+t.val[0]).join(" "),u=o||d.length>i,c=h.map(t=>t.val.map((e,i)=>(function(t,e,i){var s=a(i);return(0==e?s+": ":" ".repeat(s.length+2))+t})(e,i,t.key))).flatten(),l=c.some(t=>t.length>s),p=r.map(s=>({key:s,val:e(t[s],i-2)})).map(t=>(function(t,e){return[e+":"].concat(t.map(t=>" "+t))})(t.val,t.key)).flatten();return l?p.map(n):u?c.map(n):["# "+d]}function o(t,e){switch(typeof t){case"string":return[a(t)];case"number":return[t.toString()];case"object":return Array.isArray(t)?function(t,e,i){var s=t.map(t=>e(t,i-2)).flatten(),a=s.join(" ");return s.some(t=>t.includes("@")||t.includes("#"))||a.length>i?s.map(r):["@ "+a]}(t,o,e):h(t,o,e)}}function d(t){return{"{":"}","[":"]",":":""}[t[t.length-1].type]}function u(t){return t.split("\n").map(t=>t.replace(/(\S+\s*)(?=:)/g,'<span class="key">$1</span>').replace(/([#@:])/g,'<span class="keyword">$1</span>')).join("\n")}Array.prototype.flatten=function(){return[].concat(...this)},Array.prototype.last=function(){return this[this.length-1]};class c{constructor(t){this.input=document.getElementById("stroke-list"),this.strokeBase=t,this.init()}init(){var t=this;window.addEventListener("keyup",function(e){"Enter"===e.key&&e.ctrlKey&&e.shiftKey?(t.strokeBase.submit(t.input.value),t.strokeBase.save()):"Enter"===e.key&&e.ctrlKey?t.strokeBase.submit(t.input.value):t.highlight()})}highlight(){this.input.style.height=this.input.scrollHeight;var t=this.input.value;document.getElementById("code-display").innerHTML=u(t)}update(t){this.input.value=t,this.highlight()}}var l=i(0),p=i(1);var y=i(2);i(3);class b extends p.a{constructor(t){super(),this.len=t.len,this.ang=t.ang,this.head=new l.a,this.tail=new l.a,this.box=new y.a,this.update()}copy(){return new b({len:this.len,ang:this.ang,head:this.head})}draw(t){t.lineTo(this.tail.x,this.tail.y)}rotate(t){this.ang+=t,this.update()}trans(t){this.head=this.head.add(new l.a(t)),this.update()}scale(t){this.len*=t,this.update()}modify(t){t=void 0===t?this.prog:this.prog.concat(t);for(let e of t)switch(Object.keys(e)[0]){case"trans":this.trans(e.trans);break;case"rotate":this.rotate(e.rotate);break;case"stretch":this.stretch(e.scale)}this.update()}update(){var t=new l.a(this.ang);this.tail=this.head.add(t.mult(this.len));var e=this.head.head(this.tail),i=this.tail.tail(this.head);this.box=new y.a(e,i)}sample(t){for(var e=[],i=new l.a(this.ang),s=t;s<this.len;s+=t)e.push(i.mult(s).add(this.head));return e}cross(t){var e=t.head.sub(t.tail).cross(t.head.sub(this.head)),i=this.head.sub(this.tail).cross(t.head.sub(this.head)),s=t.head.sub(t.tail).cross(this.tail.sub(this.head));return{s:e/s,t:i/s}}}class f extends p.a{constructor(t){super(b,t),this.update()}at(t){for(var e=t*this.body.reduce((t,e)=>t+e.len,0),i=0,s=null,a=0;a<this.body.length&&!(i+(s=this.body[a]).len>=e);a++)i+=this.body[a].len;var r=(e-i)/s.len,n=s.tail.sub(s.head).mult(r);return s.head.add(n)}}class v extends p.a{constructor(t){super(f,t),this.update()}at(t){return this.body[t.curve].at(t.r)}sample(t){return this.body.map(function(e){return e.sample(t)})}}function m(t){var e=4*t.width,i=t.height,s=t.data,a=0,r=0,n=0;for(let t=0;t<i;t++)for(let i=0;i<e;i+=4)s[t*e+i]>0&&(a+=i,r+=t,n+=1);return{density:n/Math.pow(Math.hypot(e,i),1.125),centroid:new l.a(a/4/n,r/n)}}class g extends p.a{constructor(t){super(v,t),console.log(t.vars),this.modify()}cross(t){var e=this.body[t.dest.ith].at(t.dest),i=this.body[t.self.ith].at(t.self);this.body[t.self.ith].trans(e.sub(i))}update(){if(this.body.length>0&&(this.body[0].update(),this.box=this.body[0].box),this.body.length>1)for(let t=1;t<this.body.length;t++)try{this.body[t].update(),this.box=this.box.union(this.body[t].box)}catch(t){console.error("StrokeSet update",this.box)}}stretchFull(t){var e,i=this.box.size(),s=t.canvas.width,a=t.canvas.height;e=Math.min(i.x,i.y)>Math.max(s,a)?Math.max(s/i.x,a/i.y):Math.min(s/i.x,a/i.y);for(let t of this.body)t.head=t.head.mult(e);this.scale(e),this.update()}transCenter(t){var e=t.canvas.width/2,i=t.canvas.height/2;for(let t of this.body)t.head=t.head.add(new l.a(e,i).sub(this.box.center()));this.update()}draw(t){this.stretchFull(t),this.transCenter(t),t.fillStyle="black",t.fillRect(-100,-100,t.canvas.width+200,t.canvas.height+200),t.setTransform(1,0,0,1,0,0),t.translate(.05*t.canvas.width,.05*t.canvas.height),t.scale(.9,.9),t.lineWidth=2,t.lineCap="square",t.lineJoin="round",t.strokeStyle="rgb(255, 255, 255, 1)";for(let e of this.body)t.beginPath(),t.moveTo(e.head.x,e.head.y),e.draw(t),t.stroke()}findSubdivision(t){}findCenterRect(t){performance.now();var e,i=t.canvas.width,s=t.canvas.height,a=m(t.getImageData(0,0,i,s)).centroid,r={density:0};for(let u=.02;u<1;u+=.02){var n=a.x*(1-u),h=a.y*(1-u),o=i*u,d=s*u;(e=m(t.getImageData(n,h,o,d))).density>r.density&&((r=e).r=u),e.centroid.add(new l.a(n,h)).draw(t)}r.centroid=r.centroid.add(new l.a(n,h)),t.fillStyle="rgb(255, 255, 255, 0.5)",t.fillRect(a.x*(1-r.r),a.y*(1-r.r),i*r.r,s*r.r);performance.now();return r}}function x(t,e){var i=function(t){return JSON.parse(JSON.stringify(t))}(e[t]);switch(i.type){case"radical":return i.body=i.body.reduce(function(t,i){var s=x(i,e);return"radical"==s.type?t.concat(s.body):t.concat(s)},[]),i;case"compound":return i.body=i.body.reduce(function(t,i){var s=x(i,e);return"compound"==s.type?t.concat(s.body):t.concat(s)},[]),i;case"simple":return{type:"compound",body:[i]}}}function _(t,e,i){var s=document.createElement("div");return s.appendChild(function(t){var e=document.createElement("label");return e.innerHTML=t,e.setAttribute("for",t),e}(t)),s.appendChild(function(t,e,i){var s=document.createElement("INPUT");return s.setAttribute("type","range"),s.classList.add("slider"),s.setAttribute("name",t),s.setAttribute("min",e.range.min),s.setAttribute("max",e.range.max),s.setAttribute("value",e.val),s.setAttribute("step",.01),s.addEventListener("input",i),s.addEventListener("change",i),s}(t,e,i)),s}var w=document.getElementById("canvas"),k=document.getElementById("canvas").getContext("2d"),S=window.devicePixelRatio;w.style.width=w.width+"px",w.style.height=w.height+"px",w.width=w.width*S,w.height=w.height*S,k.scale(S,S),new class{constructor(t){this.base={},this.ctx=t,this.input=new c(this),this.currCharName="",this.currStrokeSpec={}}updateBase(){new Promise(function(t,e){var i=new XMLHttpRequest;i.open("GET","data/stroke-spec.json",!0),i.onload=function(){this.status>=200&&this.status<300?t(i.response):e({status:this.status,statusText:i.statusText})},i.onerror=function(){e({status:this.status,statusText:i.statusText})},i.send()}).then(function(t){this.base=JSON.parse(t),this.updateUI(this.base)}.bind(this))}updateUI(t){var e=document.getElementById("char-list");for(let s in t)if("radical"==t[s].type){var i=document.createElement("button");i.appendChild(document.createTextNode(s)),i.classList.add("char-button"),i.onclick=function(t){this.getStroke(s),this.currCharName=s,this.input.update(this.getStrokeSpecText(s))}.bind(this),e.appendChild(i)}}submit(){var t=document.getElementById("stroke-list").value,e=JSON.parse(function(t){var e=t.split("\n").filter(t=>!t.match(/^\s*$/)),i="",s=[],a=0;for(let t=0;t<e.length;t++){for(var r=e[t].search(/\S|$/);s.length>0&&s[s.length-1].indent>=r;)i+=d(s),s.pop();a=0;for(var n=e[t];n.length>0;)switch(n[0]){case" ":s[s.length-1].comma?i+=", ":s[s.length-1].comma=!0,a+=n.search(/\S|$/),n=n.trim();break;case"@":i+="[",s.push({type:"[",indent:a,comma:!1}),a+=1,n=n.slice(1);break;case"#":i+="{",s.push({type:"{",indent:a,comma:!1}),a+=1,n=n.slice(1);break;case":":i+=":",s.push({type:":",indent:a}),a+=1,n=n.slice(1);break;case'"':var h=n.match(/"(?:\\"|[^"])*"/);if(!h)throw"Quoted string missing at Line: "+t;s.length>0&&":"==s[s.length-1].type&&s.pop(),a+=h[0].length,i+=n.slice(0,h[0].length),n=n.slice(h[0].length);break;default:var o=n.match(/[^\s:]*/);if(!o)throw"Simple string got some problem at Line: 1";s.length>0&&":"==s[s.length-1].type&&s.pop(),a+=o[0].length;var u=n.slice(0,o[0].length),c=parseFloat(u);i+=c||0==c?c:'"'+u+'"',n=n.slice(o[0].length)}}for(;s.length>0&&s[s.length-1].indent>=0;)i+=d(s),s.pop();return i}(t));this.base[this.currCharName]=e,this.getStroke(this.currCharName),this.base[this.currCharName].text=t}save(){(function(t){return new Promise(function(e,i){var s=new XMLHttpRequest;s.open("POST","save",!0),s.setRequestHeader("content-type","application/json"),s.onload=function(){this.status>=200&&this.status<300?e(s.response):i({status:this.status,statusText:s.statusText})},s.onerror=function(){i({status:this.status,statusText:s.statusText})},s.send(t)})})(JSON.stringify(this.base,null,2)).then(function(t){console.log("persisted")}).catch(function(t){console.log("error",t)})}getStrokeSpec(t){this.currStrokeSpec=x(t,this.base)}getStrokeSpecText(t){return void 0===this.base[t].text?function(t){return o(t,s).join("\n")}(this.base[t]):this.base[t].text}initVariableControls(t){let e=document.getElementById("var-bars");for(;e.firstChild;)e.removeChild(e.firstChild);let i=this.currStrokeSpec.vars;for(let t in i)e.appendChild(_(t,i[t],function(e){i[t].val=parseFloat(e.target.value),this.updateStroke()}.bind(this)))}getStroke(t){this.getStrokeSpec(t),this.initVariableControls(),this.updateStroke()}updateStroke(){var t=new g(this.currStrokeSpec);t.draw(this.ctx),t.findCenterRect(this.ctx)}}(k).updateBase()}]);