!function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){"use strict";i.d(e,"a",function(){return r});class r{constructor(t,e){void 0===e?void 0===t?(this.x=0,this.y=0):void 0!==t.x&&void 0!==t.y?(this.x=t.x,this.y=t.y):"number"==typeof t&&(this.x=Math.cos(t*Math.PI/180),this.y=Math.sin(t*Math.PI/180)):(this.x=t,this.y=e)}add(t){return new r(this.x+t.x,this.y+t.y)}iadd(t){this.x+=t.x,this.y+=t.y}sub(t){return new r(this.x-t.x,this.y-t.y)}isub(t){this.x-=t.x,this.y-=t.y}mult(t){return void 0===t.x?new r(this.x*t,this.y*t):new r(this.x*t.x,this.y*t.y)}imult(t){void 0===t.x?(this.y*=t,this.x*=t):(this.x*=t.x,this.y*=t.y)}neg(){return new r(-this.x,-this.y)}cross(t){return this.x*t.y-t.x*this.y}head(t){return new r(Math.min(this.x,t.x),Math.min(this.y,t.y))}isHeaderTo(t){return this.x<t.x&&this.y<t.y}tail(t){return new r(Math.max(this.x,t.x),Math.max(this.y,t.y))}isTailerTo(t){return this.x>t.x&&this.y>t.y}copy(){return new r(this.x,this.y)}mag(){return Math.hypot(this.x,this.y)}sampleTo(t,e){var i=[],r=t.sub(this);for(let t=0;t<e;t++)i.push(this.add(r.mult((t+.5)/e)));return i}sampleStepTo(t,e){var i=[],r=t.sub(this),s=r.mag();for(let t=0;t<s;t+=e)i.push(this.add(r.mult(t/s)));return i.push(t),i}isNaN(){return isNaN(this.x)||isNaN(this.y)}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return CurveStructureBase});var _Vec_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_Box_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2);class CurveStructureBase{constructor(t,e){this.body=void 0===e||void 0===e.body?[]:e.body.map(e=>new t(e)),this.head=void 0===e||void 0===e.head?new _Vec_js__WEBPACK_IMPORTED_MODULE_0__.a:e.head,this.prog=void 0===e||void 0===e.prog?[]:e.prog,this.vars=void 0===e||void 0===e.vars?{}:e.vars,this.box=new _Box_js__WEBPACK_IMPORTED_MODULE_1__.a}rotate(t){this.body.forEach(e=>e.rotate(t)),this.update()}scale(t){this.body.forEach(e=>e.scale(t)),this.update()}trans(t){this.head=this.head.add(t),this.update()}len(){return this.body.reduce((t,e)=>t+e.len(),0)}getVariable(item){switch(typeof item){case"number":return item;case"string":if(item in this.vars){if("string"==typeof this.vars[item]&&this.vars[item].match(/@'\S*'/)){let s=this.vars[item].replace(/@'([^']*)'/g,"this.getVariable('$1')");return eval(s)}return this.vars[item].val}if(item.match(/@'\S*'/)){let s=item.replace(/@'([^']*)'/g,"this.getVariable('$1')");return eval(s)}throw{error:"ValueError",message:"item "+item+"is neither an existing variable or an expression"};case"object":let o={};for(let t in item)o[t]=this.getVariable(item[t]);return o;default:console.error("Key not found",item,typeof item)}}modify(t,e){e=void 0===e?this.vars:Object.assign(this.vars,e),void 0===t&&(t=this.prog);for(let t of this.body)t.modify(void 0,e);for(let e of t)for(let t in e){var i=void 0===e.ith?this:this.body[e.ith];"prog"!=t?i[t](this.getVariable(e[t])):i.modify(e[t])}this.update()}ith(){}update(){if(this.body.length>0&&(this.body[0].head=this.head.copy(),this.body[0].update(),this.box=this.body[0].box,this.tail=this.body[0].tail),this.body.length>1)for(let t=1;t<this.body.length;t++)try{this.body[t].head=this.body[t-1].tail.copy(),this.body[t].update(),this.tail=this.body[t].tail,this.box=this.box.union(this.body[t].box)}catch(t){}}copy(){var t=new this.constructor;return t.body=this.body.map(t=>t.copy()),t.head=this.head.copy(),t}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});var r=i(0);class s{constructor(t,e){void 0===e&&(e=new r.a),void 0===t&&(t=new r.a),this.head=t.copy(),this.tail=e.copy()}union(t){var e=this.head.head(t.head),i=this.tail.tail(t.tail);return new s(e,i)}copy(){return new s(this.head.copy(),this.tail.copy())}center(){return this.head.add(this.tail).mult(new r.a(.5,.5))}size(){return this.tail.sub(this.head)}include(t){return t.isTailerTo(this.head)&&t.isHeaderTo(this.tail)}moveWithHead(t){var e=this.size();return new s(t,t.add(e))}set(t,e,i,r){this.head.x=t,this.head.y=e,this.tail.x=t+i,this.tail.y=e+r}draw(t){var e=this.size();t.lineWidth=1,t.beginPath(),t.rect(this.head.x,this.head.y,e.x,e.y),t.stroke()}}},function(t,e,i){"use strict";i.r(e);var r=i(0),s=i(1),n=i(2);class a extends s.a{constructor(t){super(),this.len=t.len,this.ang=t.ang,this.head=new r.a,this.tail=new r.a,this.box=new n.a,this.head.w=void 0===t.weight?1:t.weight[0],this.tail.w=void 0===t.weight?1:t.weight[1],this.update()}copy(){return new a({len:this.len,ang:this.ang,head:this.head})}rotate(t){this.ang+=t,this.update()}trans(t){this.head=this.head.add(new r.a(t)),this.update()}scale(t){this.len*=t,this.update()}modify(t){t=void 0===t?this.prog:this.prog.concat(t);for(let e of t)switch(Object.keys(e)[0]){case"trans":this.trans(e.trans);break;case"rotate":this.rotate(e.rotate);break;case"stretch":this.stretch(e.scale)}this.update()}update(){var t=new r.a(this.ang);this.tail=this.head.add(t.mult(this.len));var e=this.head.head(this.tail),i=this.tail.tail(this.head);this.box=new n.a(e,i)}}class o extends s.a{constructor(t){super(a,t),this.update()}at(t){for(var e=t*this.body.reduce((t,e)=>t+e.len,0),i=0,r=null,s=0;s<this.body.length&&!(i+(r=this.body[s]).len>=e);s++)i+=this.body[s].len;var n=(e-i)/r.len,a=r.tail.sub(r.head).mult(n);return r.head.add(a)}curl(t){var e=0;for(let i=0;i<this.body.length;i++)this.body[i].ang+=e,e+=t;this.update()}}class h extends s.a{constructor(t){super(o,t),this.update()}curl(t){1==this.body.length&&this.body[0].curl(t)}at(t){return this.body[t.curve].at(t.r)}toPointList(){var t=[this.body[0].body[0].head];for(let i=0;i<this.body.length;i++){var e=this.body[i].body;for(let i=1;i<e.length;i++)t.push(e[i].head);i!=this.body.length-1&&(e[e.length-1].tail.intersect=!0),t.push(e[e.length-1].tail)}return[t]}}class l extends s.a{constructor(t){super(h,t),this.modify(),this.toPointList()}cross(t){var e=this.body[t.dest.ith].at(t.dest),i=this.body[t.self.ith].at(t.self);this.body[t.self.ith].trans(e.sub(i))}update(){if(this.body.length>0&&(this.body[0].update(),this.box=this.body[0].box),this.body.length>1)for(let t=1;t<this.body.length;t++)this.body[t].update(),this.box=this.box.union(this.body[t].box)}toPointList(){for(let t of this.body)t.head=t.head.mult(16);this.scale(16),this.trans(this.box.center().neg()),this.points=[];for(let t of this.body)this.points=this.points.concat(t.toPointList())}}var u=120;function c(t){return t.match(/[ @]/)?'"'+t+'"':t}function d(t,e){return(0==e?"@ ":"  ")+t}function p(t,e){return(0==e?"# ":"  ")+t}function m(t,e,i){var r=Object.keys(t),s=r.map(r=>({key:r,val:e(t[r],i-r.length)})),n=s.map(t=>t.val.some(t=>t.includes("@")||t.includes("#"))).some(t=>t),a=s.map(t=>c(t.key)+": "+t.val[0]).join(" "),o=n||a.length>i,h=s.map(t=>t.val.map((e,i)=>(function(t,e,i){var r=c(i);return(0==e?r+": ":" ".repeat(r.length+2))+t})(e,i,t.key))).flatten(),l=h.some(t=>t.length>u),d=r.map(r=>({key:r,val:e(t[r],i-2)})).map(t=>(function(t,e){return[e+":"].concat(t.map(t=>" "+t))})(t.val,t.key)).flatten();return l?d.map(p):o?h.map(p):["# "+a]}function g(t,e){switch(typeof t){case"string":return[c(t)];case"number":return[t%1==0?t.toString():t.toFixed(3)];case"object":return Array.isArray(t)?function(t,e,i){var r=t.map(t=>e(t,i-2)).flatten(),s=r.join(" ");return r.some(t=>t.includes("@")||t.includes("#"))||s.length>i?r.map(d):["@ "+s]}(t,g,e):m(t,g,e)}}function y(t){return g(t,u).join("\n")}function v(t){return{"{":"}","[":"]",":":""}[t[t.length-1].type]}function f(t){return t.split("\n").map(t=>t.replace(/(\S+\s*)(?=:)/g,'<span class="key">$1</span>').replace(/([#@:])/g,'<span class="keyword">$1</span>')).join("\n")}Array.prototype.flatten=function(){return[].concat(...this)},Array.prototype.last=function(){return this[this.length-1]};class b{constructor(t){this.input=document.getElementById("stroke-list"),this.strokeBase=t,this.init()}init(){var t=this;window.addEventListener("keyup",function(e){"Enter"===e.key&&e.ctrlKey&&e.shiftKey?(t.strokeBase.submit(t.input.value),t.strokeBase.save()):"Enter"===e.key&&e.ctrlKey?t.strokeBase.submit(t.input.value):t.highlight()})}highlight(){this.input.style.height=this.input.scrollHeight;var t=this.input.value;document.getElementById("code-display").innerHTML=f(t)}update(t){this.input.value=t,this.highlight()}}function x(t,e){let i=function(t){return JSON.parse(JSON.stringify(t))}(e[t]);switch(delete i.text,i.type){case"radical":return i.body=i.body.reduce(function(t,i){let r=x(i,e);return"radical"==r.type?t.concat(r.body):t.concat(r)},[]),i;case"compound":return i.body=i.body.reduce(function(t,i){let r=x(i,e);return"compound"==r.type?t.concat(r.body):t.concat(r)},[]),i;case"simple":return{type:"compound",body:[i]}}}function w(t,e){switch(t){case"rotate":return{val:e,range:{min:e-20,max:e+20}};case"curl":return{val:e,range:{min:e-10,max:e+10}};case"scale":return{val:e,range:{min:.8*e,max:e/.8}};case"r":return{val:e,range:{min:e-.1,max:e+.1}}}}function _(t,e,i){var r=document.createElement("INPUT");return r.setAttribute("type","range"),r.classList.add("slider"),r.setAttribute("name",t),r.setAttribute("min",e.range.min),r.setAttribute("max",e.range.max),r.setAttribute("value",e.val),r.setAttribute("step",.001),r.addEventListener("input",i),r.addEventListener("change",i),r}function k(t){var e=document.createElement("label");return e.innerHTML=t,e.setAttribute("for",t),e}function S(t,e,i){var r=document.createElement("div");return r.appendChild(k(t)),void 0!=e.val&&(r.appendChild(_(t,e,i)),r.appendChild(function(t,e){var i=document.createElement("SPAN");return i.setAttribute("id",t+"-indicator"),i.classList.add("indicator"),i.innerText=e,i}(t,e.val))),r}class C{constructor(){this.base={},this.input=new b(this),this.currCharName="",this.currSpec={},this.shouldShowStrokes=!1,document.getElementById("create").onclick=function(t){this.create()}.bind(this),document.getElementById("show-stroke").onclick=function(t){this.shouldShowStrokes=!this.shouldShowStrokes,this.updateUI(this.base)}.bind(this),document.getElementById("generate-spec").onclick=function(t){this.suggest()}.bind(this),document.getElementById("replace-vars").onclick=function(t){this.replaceVars()}.bind(this)}updateBase(){new Promise(function(t,e){var i=new XMLHttpRequest;i.open("GET","data/stroke-spec.json",!0),i.onload=function(){this.status>=200&&this.status<300?t(i.response):e({status:this.status,statusText:i.statusText})},i.onerror=function(){e({status:this.status,statusText:i.statusText})},i.send()}).then(function(t){this.base=JSON.parse(t),this.updateUI(this.base)}.bind(this))}updateUI(t){for(var e=document.getElementById("char-list");e.firstChild;)e.removeChild(e.firstChild);for(let r in t)if(this.shouldShowStrokes||"radical"===this.base[r].type){var i=document.createElement("button");i.appendChild(document.createTextNode(r)),i.classList.add("char-button"),i.onclick=function(t){this.currCharName=r,this.initStroke(r),this.input.update(this.getStrokeSpecText(r))}.bind(this),e.appendChild(i)}}submit(){var t=document.getElementById("stroke-list").value,e=JSON.parse(function(t){var e=t.split("\n").filter(t=>!t.match(/^\s*$/)),i="",r=[],s=0;for(let t=0;t<e.length;t++){for(var n=e[t].search(/\S|$/);r.length>0&&r[r.length-1].indent>=n;)i+=v(r),r.pop();s=0;for(var a=e[t];a.length>0;)switch(a[0]){case" ":r[r.length-1].comma?i+=", ":r[r.length-1].comma=!0,s+=a.search(/\S|$/),a=a.trim();break;case"@":i+="[",r.push({type:"[",indent:s,comma:!1}),s+=1,a=a.slice(1);break;case"#":i+="{",r.push({type:"{",indent:s,comma:!1}),s+=1,a=a.slice(1);break;case":":i+=":",r.push({type:":",indent:s}),s+=1,a=a.slice(1);break;case'"':var o=a.match(/"(?:\\"|[^"])*"/);if(!o)throw"Quoted string missing at Line: "+t;r.length>0&&":"==r[r.length-1].type&&r.pop(),s+=o[0].length,i+=a.slice(0,o[0].length),a=a.slice(o[0].length);break;default:var h=a.match(/[^\s:]*/);if(!h)throw"Simple string got some problem at Line: 1";r.length>0&&":"==r[r.length-1].type&&r.pop(),s+=h[0].length;var l=a.slice(0,h[0].length),u=parseFloat(l);i+=u||0==u?u:'"'+l+'"',a=a.slice(h[0].length)}}for(;r.length>0&&r[r.length-1].indent>=0;)i+=v(r),r.pop();return i}(t));this.base[this.currCharName]=e,this.base[this.currCharName].text=t,this.initStroke(this.currCharName)}save(){var t=JSON.stringify(this.base,null,2),e=this.currCharName;(function(t){return new Promise(function(e,i){var r=new XMLHttpRequest;r.open("POST","save",!0),r.setRequestHeader("content-type","application/json"),r.onload=function(){this.status>=200&&this.status<300?e(r.response):i({status:this.status,statusText:r.statusText})},r.onerror=function(){i({status:this.status,statusText:r.statusText})},r.send(t)})})(t).then(function(t){document.getElementById("indicator").innerText="『"+e+"』字编辑已然保存"}).catch(function(t){console.log("error",t)})}suggest(){this.submit(),this.getStrokeSpec(this.currCharName),this.base[this.currCharName]=function(t,e){console.log(t,e,"suggestSpec");var i={body:t.body,type:t.type,prog:[]};for(let t=0;t<e.body.length;t++){let r=e.body[t];console.log(r,"suggestedSpec stroke"),1==r.body.length?i.prog.push({ith:t,scale:1,rotate:0,curl:0}):i.prog.push({ith:t,prog:r.body.map((t,e)=>({ith:e,scale:1,rotate:0,curl:0}))})}if(e.body.length>1)for(let t=1;t<e.body.length;t++)i.prog.push({cross:{dest:{ith:t-1,curve:0,r:0},self:{ith:t,curve:0,r:0}}});return console.log(i,"suggestedSpec"),i}(this.base[this.currCharName],this.currSpec),this.base[this.currCharName].text=y(this.base[this.currCharName]),this.input.update(this.base[this.currCharName].text),this.initStroke(this.currCharName)}replaceVars(){delete this.base[this.currCharName].text,console.log(this.base[this.currCharName]),this.base[this.currCharName]=function(t){t.vars={};let e=0,i=0;for(let r=0;r<t.prog.length;r++)for(let s in t.prog[r])if("ith"==s)e=t.prog[r].ith;else if("prog"==s)for(let s=0;s<t.prog[r].prog.length;s++)for(let n in t.prog[r].prog[s])if("ith"==n)i=t.prog[r].prog[s].ith;else{let a=n in["rotate","curl"]&&0==t.prog[r].prog[s][n],o="scale"==n&&1==t.prog[r].prog[s][n];if(!a&&!o){let a=n+"-"+e+"-"+i;t.vars[a]=w(n,t.prog[r].prog[s][n]),t.prog[r].prog[s][n]=a}}else if("cross"==s){let e=t.prog[r].cross,i="cross-"+e.self.ith+"-"+e.dest.ith+"-self",s="cross-"+e.self.ith+"-"+e.dest.ith+"-dest";1!=e.self.r&&0!=e.self.r&&(t.vars[i]=w("r",e.self.r),t.prog[r].cross.self.r=i),1!=e.dest.r&&0!=e.dest.r&&(t.vars[s]=w("r",e.dest.r),t.prog[r].cross.dest.r=s)}else{let i=("rotate"==s||"curl"==s)&&0==t.prog[r][s],n="scale"==s&&1==t.prog[r][s],a=i||n;if(console.log(s,t.prog[r][s],s in["rotate","curl"]),!a){let i=s+"-"+e;t.vars[i]=w(s,t.prog[r][s]),t.prog[r][s]=i}}return t}(this.base[this.currCharName]),this.base[this.currCharName].text=y(this.base[this.currCharName]),this.input.update(this.base[this.currCharName].text),this.initStroke(this.currCharName)}create(){var t=document.getElementById("new-char-name").value;void 0!==this.base[t]?document.getElementById("indicator").innerText="『"+t+"』字已然存在了":(this.base[t]={type:"radical",body:[],vars:{},prog:[]},this.currCharName=t,this.currSpec=this.base[t],this.updateUI(this.base))}getStrokeSpec(t){var e=this.base[t].type;document.getElementById("indicator").innerText="载入"+{radical:"部首",compound:"笔画",simple:"简单笔画"}[e]+"『"+t+"』",this.currSpec=function(t,e){return"radical"==e[t].type?x(t,e):{type:"radical",vars:{},body:[x(t,e)]}}(t,this.base)}getStrokeSpecText(t){return void 0===this.base[t].text?y(this.base[t]):this.base[t].text}initVariableControls(){let t=document.getElementById("var-bars");for(;t.firstChild;)t.removeChild(t.firstChild);let e=document.createElement("div");if(e.appendChild(k("笔画宽度")),this.strokeWidth=8,e.appendChild(_(name,{val:4,range:{min:1,max:15}},function(t){this.strokeWidth=parseFloat(t.target.value),this.updateStroke()}.bind(this))),t.appendChild(e),this.currSpec.vars){let e=this.currSpec.vars;for(let i in e)t.appendChild(S(i,e[i],function(t){void 0!=e[i].val&&(e[i].val=parseFloat(t.target.value),document.getElementById(t.target.name+"-indicator").innerText=e[i].val),this.updateStroke()}.bind(this)))}}initStroke(t){}}function T(t,e,i,r){var s=t.sub(i).cross(i.sub(r)),n=-t.sub(e).cross(t.sub(i)),a=t.sub(e).cross(i.sub(r)),o=s/a,h=n/a;return{p:t.add(e.sub(t).mult(o)),s:o,t:h}}function E(t,e){return function(t,e,i){return e.sub(t).cross(i.sub(t))}(t[t.length-2],t[t.length-1],e)}function N(t){t.sort(function(t,e){return t.x==e.x?t.y-e.y:t.x-e.x});for(var e=[],i=0;i<t.length;i++){for(;e.length>=2&&E(e,t[i])<=0;)e.pop();e.push(t[i])}var r=[];for(i=t.length-1;i>=0;i--){for(;r.length>=2&&E(r,t[i])<=0;)r.pop();r.push(t[i])}return r.pop(),e.pop(),e.concat(r)}function P(t){var e=new r.a,i=0;for(let r=0;r<t.length;r++){var s=t[(r+1)%t.length].add(t[r]).mult(.5),n=t[(r+1)%t.length].sub(t[r]).mag();e=e.add(s.mult(n)),i+=n}return e.mult(1/i)}function H(t){let e=function(t){var e=t.map(t=>t.slice(0).map(t=>{let e=t.copy();return t.intersect&&(e.intersect=t.intersect),e}));for(let t=0;t<e.length;t++)for(let o=0;o<t;o++)for(let h=0;h<e[t].length-1;h++)for(let l=0;l<e[o].length-1;l++){var i=T(e[t][h],e[t][h+1],e[o][l],e[o][l+1]),r=i.p,s=i.p.copy();r.intersect=!0,s.intersect=!0;var n=i.s>=-.001&&i.s<=1.001,a=i.t>=-.001&&i.t<=1.001;n&&a&&(e[t].splice(1+h++,0,r),e[o].splice(1+l++,0,s))}for(let t=0;t<e.length;t++){var o=[[]];for(let i=0;i<e[t].length;i++)if(o[o.length-1].push(e[t][i]),e[t][i].intersect){let r=e[t][i].copy();r.intersect=!0,o.push([r])}e[t]=o}return e}(t);var i=[],r=[],s=[];for(let t=0;t<e.length;t++)for(let r=0;r<e[t].length;r++){let n=e[t][r];n[0].intersect&&n[n.length-1].intersect&&(i=i.concat(n)),s=s.concat(n)}var n=N(i),a=N(s),o=P(n),h=P(a),l=n.map(t=>t.sub(o).mag()),u=a.map(t=>t.sub(h).mag()),c=l.mean(),d=u.mean(),p=l.max()-l.min(),m=u.max()-u.min();for(let t=0;t<e.length;t++)for(let i=0;i<e[t].length;i++){let s=e[t][i],n=[];if(s[0].intersect&&s[s.length-1].intersect)r=r.concat(s);else{s[s.length-1].intersect&&s.reverse();for(let t=0;t<s.length-1;t++)n=n.concat(s[t].sampleStepTo(s[t+1],.1));r.push(n[Math.floor(.618*n.length)])}}var g=N(r),y=P(g),v=g.map(t=>t.sub(y).mag()),f=v.mean(),b=v.max()-v.min();return{interior:{convexHull:n,centroid:o,radius:c,extrema:p},median:{convexHull:g,centroid:y,radius:f,extrema:b},outlier:{convexHull:a,centroid:h,radius:d,extrema:m}}}Array.prototype.sum=function(){return 0==this.length?0:this.reduce((t,e)=>t+e)},Array.prototype.mean=function(){return this.sum()/this.length},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.last=function(){return this[this.length-1]},Array.prototype.sum=function(){return 0==this.length?0:this.reduce((t,e)=>t+e)},Array.prototype.mean=function(){return this.sum()/this.length};(new class extends C{constructor(){super(),this.preview=document.getElementById("preview").getContext("2d"),this.previewFont="Source Han Serif CN"}initStroke(t){this.getStrokeSpec(t),this.initVariableControls(),this.radical=new l(this.currSpec),this.updateWithPoint()}updateStroke(){this.radical=new l(this.currSpec),this.updateWithPoint()}updateWithPoint(){let t=this.radical.points,e=H(t),i=e.median.centroid.isNaN()?e.outlier.centroid:e.median.centroid;console.log(i,e),this.preview.clearRect(-128,-128,384,384);for(let e=0;e<t.length;e++)for(let r=0;r<t[e].length;r++)t[e][r].isub(i);for(let t=0;t<e.outlier.convexHull;t++)e.outlier.convexHull[t].isub(i);for(let t=0;t<e.median.convexHull;t++)e.median.convexHull[t].isub(i);for(let t=0;t<e.interior.convexHull;t++)e.interior.convexHull[t].isub(i);this.preview.beginPath(),this.preview.rect(16,16,224,224),this.preview.stroke(),this.preview.translate(128,128),this.preview.lineWidth=this.strokeWidth,this.preview.lineCap="square",this.preview.lineJoin="miter",this.preview.miterLimit=3,this.preview.strokeStyle="black";for(let e=0;e<t.length;e++){let i=0;for(this.preview.beginPath(),this.preview.moveTo(t[e][i].x,t[e][i].y);i<t[e].length;)if(t[e].length-i>3)this.preview.bezierCurveTo(t[e][i+1].x,t[e][i+1].y,t[e][i+2].x,t[e][i+2].y,t[e][i+3].x,t[e][i+3].y),i+=3;else{let r=t[e][i];this.preview.lineTo(r.x,r.y),i+=1}this.preview.stroke()}this.preview.translate(-i.x,-i.y),this.preview.lineWidth=1,console.log(e.median.convexHull),this.preview.beginPath(),this.preview.moveTo(e.median.convexHull[0].x,e.median.convexHull[0].y);for(let t=0;t<e.median.convexHull.length;t++)this.preview.lineTo(e.median.convexHull[t].x,e.median.convexHull[t].y);this.preview.closePath(),this.preview.stroke(),console.log(e.outlier.convexHull),this.preview.beginPath(),this.preview.moveTo(e.outlier.convexHull[0].x,e.outlier.convexHull[0].y);for(let t=0;t<e.outlier.convexHull.length;t++)this.preview.lineTo(e.outlier.convexHull[t].x,e.outlier.convexHull[t].y);this.preview.closePath(),this.preview.stroke(),this.preview.setTransform(1,0,0,1,0,0)}}).updateBase()}]);